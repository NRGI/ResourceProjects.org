//////////////////
//SOURCE SCHEMA///
//////////////////
'use strict';
var mongoose = require('mongoose');
require('mongoose-html-2').loadType(mongoose);

var glossaryPageSchema, GlossaryPage,
    Schema          = mongoose.Schema,
    ObjectId        = Schema.Types.ObjectId,
    HTML            = mongoose.Types.Html,
    htmlSettings    = {
        type: HTML,
        setting: {
            allowedTags: [ 'h1', 'h2','h3', 'h4', 'h5', 'h6', 'blockquote', 'p', 'a', 'ul', 'ol',
                'nl', 'li', 'b', 'i','u', 'strong', 'em', 'strike', 'code', 'hr', 'br', 'div',
                'table', 'thead', 'caption', 'tbody', 'tr', 'th', 'td', 'pre','img','pre','strike'],
            allowedAttributes: {

                '*': [ 'href', 'align', 'alt', 'center', 'bgcolor','style' ],
                a: [ 'href', 'name', 'target' ],
                img: [ 'src','class']
            },
            selfClosing: [ 'img', 'br', 'hr', 'area', 'base', 'basefont', 'input', 'link', 'meta' ],
            allowedSchemes: [ 'http', 'https', 'ftp', 'mailto' ],
            allowedSchemesByTag: {}
        }
    };

glossaryPageSchema = new Schema({
    glossary_text: htmlSettings
});

GlossaryPage = mongoose.model('GlossaryPage', glossaryPageSchema);

function createDefaultGlossaryPage() {
    GlossaryPage.find({}).count().exec(function(err, glossary_page_count) {
        if(glossary_page_count === 0) {
            GlossaryPage.create({_id:"57639b9e2b50bbd70c2ff251",glossary_text:'<h3>Projects and interrelated key concepts:</h3><p><strong>Project (resource project):</strong> Resource projects represent the basic organizing unit for extractive operations in a country. Governments, companies and citizens all report a vast amount of information on a project by project basis. ResourceProjects.org refers to the EU Accounting Directive definition as our core means for defining a project. The EU definition will be applied by all EU countries and has already been used in voluntary company disclosures and mandatory  disclosures by companies based in Norway. It is also mirrored in the [draft] Extractive Sector Transparency Measures Act (ESTMA) technical reporting specifications in Canada.</p><p>Some data sources may, however, define projects differently than the EU Accounting Directive and ESTMA. When this occurs, ResourceProjects.org does not attempt to impose an authoritative project definition or name. Instead, wherever possible, we link projects as defined under the Accounting Directive and ESTMA with other aliases by which they may be known in the public domain or in other data sources. By documenting different sources of how and how often projects are being referred to, ResourceProjects.org aims to build a comprehensive list of projects across the globe while also mapping out inconsistencies in project attribution.</p><p><a href="http://eur-lex.europa.eu/legal-content/EN/TXT/?uri=celex:32013L0034"> EU Accounting Directive</a> (Directive 2013/34/EU, art 41(4)):</p><div class="blockquote"><small>\'project\' means the operational activities that are governed by a single contract, license, lease, concession or similar legal agreements and form the basis for payment liabilities with a government. None the less, if multiple such agreements are substantially interconnected, this shall be considered a project;“  (...) "Substantially interconnected legal agreements should be understood as a set of operationally and geographically integrated contracts, licenses, leases or concessions or related agreements with substantially similar terms that are signed with a government, giving rise to payment liabilities.</small></div><p></p><p><strong>Contract (resource contract):</strong> An agreement or set of legal terms whereby generally a government entity or its representative (e.g., state owned enterprise) grants a company the right to explore and/or extract a resource in a given area in return for paying to the government royalties, taxes or other consideration. Resource contracts are known in different countries by various names, including lease, license, concession, block, mineral development agreement (MDA), and production sharing contract (PSC), among others. In ResourceProjects.org one or more contracts may be associated with a project: ideally via the contract title, and a web link to details of the full contract text.</p><p><strong>Concession Area / License Area / Block :</strong> Designated geographic areas over which resource exploration and/or extraction rights are granted.The naming convention for areas designated for exploration and production varies across countries and between the petroleum and mining sectors.In practice a project is often associated with a single concession area / license area / block. Within  ResourceProjects.org one or more concession area / license area / block can be linked to a project.</p><p><strong>Oil or gas field:</strong> An area of land or seabed with a hydrocarbons reservoir or multiple geologically related reservoirs beneath, especially in amounts that justify commercial exploitation. When oil or gas fields are discovered, they are often given a name, sometimes following the name on the well with which the discovery was made. Oil and gas projects may aim to recover oil and/or gas from one or multiple connected fields.</p><p><strong>Mine site:</strong> Places or areas from which commercial minerals are or were removed by excavation. A project would typically include one or multiple closely linked mine sites.</p><h3>Company attributes:</h3><p><strong>Company:</strong> The name of the companies directly associated with the project. This can include companies that are holders of the mining or petroleum license, permit or other legal right to explore and/or extract, are signatories to the mining or petroleum contracts, have an ownership stake in the project, pay taxes related to commodity extraction to the government. Where possible, the recorded company name should match the name used in a national company registry or an opencorporates.org entry.</p><p><strong>Company group:</strong> Records the name of parent entities of the companies associated with a project. Where several layers of ownership exist, the name of the ultimate parent entity should be used. Often this may be the name of the entity listed on a stock exchange or of the entity that produces consolidated annual reports on behalf of subsidiaries.</p><p><strong>Company home country:</strong> Records the name of the country where the company directly associated with the project is registered.</p><p><strong>Company participating interest percentage (Share):</strong> Joint ventures and other structures whereby two or more companies agree to share profit, loss and control in a certain project are common in the extractive sector, especially the oil industry. ResourceProjects.org records the participating interest percentage a company has in a project.</p><p><strong>Operator:</strong> The company responsible for managing operations with respect to a particular project. The operator designation is primarily used in oil projects involving a joint venture. ResourceProjects.org aims to identify the operator of a given project and and records whether a participating company acts as the operator. Where there is an operator it is sometimes explicitly identified in the contract and can  often be identified in government and/or company descriptions of the project.</p><h3>Project attributes:</h3><p><strong>Alias:</strong> A given project may appear under different aliases across reports and databases. This may include names in different language, colloquial names, shortened and full versions of project names.</p><p><strong>Status:</strong> ResourceProjects.org categorises project status according to the following general categories (<em><a href="http://www-wds.worldbank.org/external/default/WDSContentServer/WDSP/CTR/2016/02/25/090224b0841b02d1/2_0/Rendered/PDF/Options0for0Ex00better0and0the0best.pdf">based on World Bank report</a></em>):</p><ol><li>Exploration: This stage includes early stage (mapping, sampling, seismic exploration) as well as late stage exploration involving project appraisal after discovery.</li><li>Construction/development: Phase following discovery and the decision to go-ahead with the project, usually based on commerciality. During this phase the  mine site or oil field is readied for production. This will include development / construction plans, and planning/constructing supporting infrastructure. Ends as production starts.</li><li>Production: The project is in production and an output for export or processing is available. Where existing operations are being expanded, these can still be listed as production stage.</li><li>On hold: Activity has been suspended for any number of reasons; technical, labor, environmental or political reasons, lack of funds etc. However, activity is expected to resume once the underlying factor has changed.</li><li>Inactive: All production activity has come to an end. Projects that are under care and maintenance can be listed here.</li><li>Unknown</li></ol><p><strong>Location of sites and fields:</strong> ResourceProjects.org records point coordinates (in lat-long format) identifying where the project is located. The extraction activities of a typical resource project are centered around an oil / gas field (and associated wells) or a mining site. Note that a single project may span across multiple oil fields or mining sites. For example the location of additional infrastructure that is referred to as part of the project but not directly related to extraction, such as processing plants, refineries, etc. can be recorded as separate sites with different locations.</p><p><strong>Commodity:</strong> The ResourceProjects.org repository focuses solely on non-renewable extractive resources. Projects are classified as either an ‘oil and gas’ or ‘mining’ project. These categories are then broken down into a list of commodities the project is producing or aims to produce (<em><a href="http://www-wds.worldbank.org/external/default/WDSContentServer/WDSP/CTR/2016/02/25/090224b0841b02d1/2_0/Rendered/PDF/Options0for0Ex00better0and0the0best.pdf">based on World Bank report</a></em>). A project may have multiple commodities associated (ie. both oil and gas, or both gold and silver).</p><p><strong>Production:</strong> The quantity of a resource extracted in a given time period. Measurement units vary across commodity.</p><p><strong>Resource:</strong> A concentration of a naturally occurring commodity whose extraction is currently or may in the future be technically and economically feasible.</p><p><strong>Reserves:</strong> The subset of total resources that is currently commercially viable to extract. Definitions used around the world still differ somewhat but there is increasing standardisation. Oil reserves are further divided into the sub-categories: proven reserves (1P), probable reserves (2P) and possible reserves (3P). Mineral reserves are subdivided into probable and proved reserves. Measurement units vary across commodity.</p><h3>Project verification:</h3><p>We are developing an automated algorithm to evaluate confidence in the existence of projects. Since project information is harvested from multiple sources, we can evaluate the number and type of sources that mention a given project.</p><p>In the current alpha version of the site we distinguish three types of verification levels for each project:</p><ol><li>Payment - A project that is solely identified within one or more company payment disclosures</li><li>Context - A project that is solely identified within one or more source other than payment disclosures. This could be EITI reports, company annual reports, site level information, etc.</li><li>Verified - A project that is identified within ate least one company payment disclosure<em><b> and</b></em> at one least one contextual information source.</li></ol><p>The current methodology requires at least a single payment disclosure and a single context information for project verification. This verification methodolgy will likely be refined in order to better ascertain data consistency and to identify ambiguities within project level reporting.</p><h3>Source attributes:</h3><p>All information stored on ResourceProjects.org is publicly available and attributed to the original source. Wherever possible data is drawn from explicitly openly licenced sources, however licensing is not always clearly specified. We store the detailed source information behind every record displayed on the repository. This includes the name of the source, URL, date of source and date of retrieval. We also categorise sources according the to the following criteria.</p><p><strong>Payment disclosure:</strong> A source that is either a mandatory payment disclosure based on the EU Accounting Directive or a voluntary project by project payment disclosure  by an extractive company.</p><p><strong>Authoritative source:</strong> This includes data from reports and databases by government and extractive companies.We also includes EITI reports and reports by international institutions (World Bank, IMF) in this category.</p><p><strong>Non-authoritative source:</strong> Any other source, including wikipedia and press articles.</p><h3>Payment attributes:</h3><p><strong>Project level payment:</strong> Payments made to government entities that are attributable to a particular project.</p><p><strong>Corporate level payment:</strong> Payment made to government entities that are incurred at the corporate level and are not easily attributable to a particular project.</p><p><strong>Payment to governments:</strong> Payments to governments are amounts paid, whether in money or in kind, to a national, regional or local authority, departments or agencies of these authorities, or to a company majority-owned by such an authority.</p><p><strong>Payment Types:</strong> ResourceProjects.org allows transfers to be classified into nine separate payment types. These payment types are based on those defined in the EU Accounting Directive.</p><ol><li>Taxes levied on the income, production or profits of companies</li><li>License fees, rental fees, entry fees, and other considerations for licenses and/or concessions</li><li>Dividends</li><li>Royalties</li><li>Signature, discovery and production bonuses</li><li>Production entitlements, which can be measured both in volumes (ie. barrels) and in value</li><li>Payments for infrastructure improvements</li><li>Other</li><li>Total (encapsulating transfers that are not disaggregated by payment type)</li></ol><h3>Useful sources:</h3><p><em>Payment reporting legislation and standards</em></p><ul><li><a href="http://eur-lex.europa.eu/legal-content/EN/TXT/?uri=celex:32013L0034">EU Accounting Directive</a></li><li><a href="http://laws-lois.justice.gc.ca/eng/acts/E-22.7/page-1.html">Extractive Sector Transparency Measures Act</a> and accompanying [draft] <a href="http://www.nrcan.gc.ca/sites/www.nrcan.gc.ca/files/pdf/estma/ESTMA_Guidance_e.pdf">Guidance</a> and <a href="http://www.nrcan.gc.ca/sites/www.nrcan.gc.ca/files/pdf/estma/Technical_Reporting_Specifications_EN.pdf">Technical Reporting Specifications</a></li><li><a href="https://www.sec.gov/about/laws/wallstreetreform-cpa.pdf">Dodd Frank Act, Section 1504</a>: The Act requires companies listed on the US Securities and Exchange Commission (SEC) to report the transfers made to governments for access to oil, gas and minerals on a project by project basis.</li><li><a href="https://eiti.org/files/English_EITI%20STANDARD_11July_0.pdf">EITI New Standard (2013)</a>: The amended EITI standard mandates reporting at the project level, provided it is consistent with the US and EU standards.</li></ul><p><em>Guides and resources on the extractive industries</em></p><ul><li><a href="http://www-wds.worldbank.org/external/default/WDSContentServer/WDSP/CTR/2016/02/25/090224b0841b02d1/2_0/Rendered/PDF/Options0for0Ex00better0and0the0best.pdf">World Bank - Options for EITI data reporting and access (2016)</a>: This report provides details on best practice in reporting  on extractive sector.</li><li><a href="http://openoil.net/understanding-oil-contracts/">Open Oil: Understanding Oil Contracts</a></li><li><a href="http://naturalresourcecharter.org/">The Natural Resources Charter</a></li><li><a href="https://www.documentcloud.org/documents/1279596-mining-contracts-how-to-read-and-understand-them.html">Mining Contracts: How to Read and Understand Them</a></li><li><a href="http://www.ey.com/Publication/vwLUAssets/EY_-_Disclosing_government_payments_for_natural_resource_extraction/$FILE/EY-Disclosing-government-transfers.pdf">Ernst and Young: Disclosing Government Payments</a></li><li><a href="https://eiti.org/glossary">The EITI Glossary</a></li></ul><p><em>Data sources</em></p><ul><li><a href="https://eiti.org/">Extractive Industries Transparency Initiative (EITI) reports</a></li><li><a href="http://www.resourcecontracts.org/">ResourceContracts.org</a></li><li><a href=":https://maps.openoil.net/concessions/">Openoil.net Concession Map</a></li><li><a href="http://repository.openoil.net/wiki/Main_Page">OpenOil.net Contract Repository</a></li><li><a href="http://search.openoil.net/">OpenOil.net Aleph</a></li><li><a href="https://opencorporates.com/">OpenCorporates</a></li></ul>'});
           } else {
            console.log(String(glossary_page_count), 'glossary page exist...')
        }
    });
};

exports.createDefaultGlossaryPage = createDefaultGlossaryPage;