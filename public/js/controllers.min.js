"use strict";angular.module("app",["angular.filter","angular-underscore","iso-3166-country-codes","angular-google-analytics","leaflet-directive","ngDialog","ngResource","ngRoute","tableSort","ngCsv","ngSanitize","angularSpinner","infinite-scroll","nvd3","textAngular"]),angular.module("app").config(["$routeProvider","$locationProvider","AnalyticsProvider",function(a,b,c){c.setAccount([{tracker:"UA-59246536-4",name:"resourceprojects.org"}]).logAllCalls(!0).startOffline(!0);var d={supervisor:{auth:function(a){return a.authorizeCurrentUserForRoute("admin")}},user:{auth:function(a){return a.authorizeAuthenticatedUserForRoute()}}};b.html5Mode(!0),a.when("/",{templateUrl:"/partials/main/main",controller:"nrgiMainCtrl"}).when("/admin/etl/datasets",{templateUrl:"/partials/admin/etl/datasets",controller:"nrgiEtlCtrl"}).when("/admin/etl/datasets/new",{templateUrl:"/partials/admin/etl/create-dataset",controller:"nrgiDatasetCreateCtrl"}).when("/admin/reconcile",{templateUrl:"/partials/admin/etl/reconcile",controller:"nrgiReconcileCtrl"}).when("/admin/create-user",{templateUrl:"/partials/admin/users/create-user",controller:"nrgiUserAdminCreateCtrl"}).when("/admin/user-admin",{templateUrl:"/partials/admin/users/user-admin",controller:"nrgiUserAdminCtrl"}).when("/admin/user-admin/:id",{templateUrl:"/partials/admin/users/user-admin-update",controller:"nrgiUserAdminUpdateCtrl"}).when("/admin/sourceType-admin",{templateUrl:"/partials/admin/sourceTypes/sourceType-admin",controller:"nrgiSourceTypeAdminCtrl"}).when("/admin/create-sourceType",{templateUrl:"/partials/admin/sourceTypes/create-sourceType",controller:"nrgiSourceTypeAdminCreateCtrl"}).when("/admin/sourceType-admin/:id",{templateUrl:"/partials/admin/sourceTypes/sourceType-admin-update",controller:"nrgiSourceTypeAdminUpdateCtrl"}).when("/admin/edit-about-page",{templateUrl:"/partials/admin/cms/aboutPage/edit-about-page",controller:"nrgiAboutPageUpdateCtrl"}).when("/admin/edit-glossary-page",{templateUrl:"/partials/admin/cms/glossaryPage/edit-glossary-page",controller:"nrgiGlossaryPageUpdateCtrl"}).when("/admin/edit-landing-page",{templateUrl:"/partials/admin/cms/landingPage/edit-landing-page",controller:"nrgiLandingPageUpdateCtrl"}).when("/login",{templateUrl:"/partials/account/login",controller:"nrgiLoginCtrl"}).when("/profile",{templateUrl:"/partials/account/profile",controller:"nrgiProfileCtrl",resolve:d.supervisor}).when("/companies",{templateUrl:"/partials/dynamic/companies/company-list",controller:"nrgiCompanyListCtrl"}).when("/company/:id",{templateUrl:"/partials/dynamic/companies/company-detail",controller:"nrgiCompanyDetailCtrl"}).when("/concessions",{templateUrl:"/partials/dynamic/concessions/concession-list",controller:"nrgiConcessionListCtrl"}).when("/concession/:id",{templateUrl:"/partials/dynamic/concessions/concession-detail",controller:"nrgiConcessionDetailCtrl"}).when("/contracts",{templateUrl:"/partials/dynamic/contracts/contract-list",controller:"nrgiContractListCtrl"}).when("/contract/:id",{templateUrl:"/partials/dynamic/contracts/contract-detail",controller:"nrgiContractDetailCtrl"}).when("/fields",{templateUrl:"/partials/dynamic/sites/site-list",controller:"nrgiSiteListCtrl"}).when("/field/:id",{templateUrl:"/partials/dynamic/sites/site-detail",controller:"nrgiSiteDetailCtrl"}).when("/fields/map",{templateUrl:"/partials/dynamic/sites/mapSiteAndProject",controller:"nrgiMapSiteCtrl"}).when("/projects",{templateUrl:"/partials/dynamic/projects/project-list",controller:"nrgiProjectListCtrl"}).when("/all-projects",{templateUrl:"/partials/dynamic/projects/all-project-list",controller:"nrgiAllProjectListCtrl"}).when("/project/:id",{templateUrl:"/partials/dynamic/projects/project-detail",controller:"nrgiProjectDetailCtrl"}).when("/sites",{templateUrl:"/partials/dynamic/sites/site-list",controller:"nrgiSiteListCtrl"}).when("/site/:id",{templateUrl:"/partials/dynamic/sites/site-detail",controller:"nrgiSiteDetailCtrl"}).when("/sites/map",{templateUrl:"/partials/dynamic/sites/mapSiteAndProject",controller:"nrgiMapSiteCtrl"}).when("/transfers",{templateUrl:"/partials/dynamic/transfers/transfer-list",controller:"nrgiTransferListCtrl"}).when("/transfers_by_gov",{templateUrl:"/partials/dynamic/transfersByGovEntity/transferByGov-list",controller:"nrgiTransferByGovListCtrl"}).when("/commodities",{templateUrl:"/partials/dynamic/commodities/commodity-list",controller:"nrgiCommodityListCtrl"}).when("/commodity/:id",{templateUrl:"/partials/dynamic/commodities/commodity-detail",controller:"nrgiCommodityDetailCtrl"}).when("/countries",{templateUrl:"/partials/dynamic/countries/country-list",controller:"nrgiCountryListCtrl"}).when("/country/:id",{templateUrl:"/partials/dynamic/countries/country-detail",controller:"nrgiCountryDetailCtrl"}).when("/groups",{templateUrl:"/partials/dynamic/groups/group-list",controller:"nrgiGroupListCtrl"}).when("/group/:id",{templateUrl:"/partials/dynamic/groups/group-detail",controller:"nrgiGroupDetailCtrl"}).when("/sources",{templateUrl:"/partials/dynamic/sources/source-list",controller:"nrgiSourceListCtrl"}).when("/source/:id",{templateUrl:"/partials/dynamic/sources/source-detail",controller:"nrgiSourceDetailCtrl"}).when("/glossary",{templateUrl:"/partials/static/glossary/glossary",controller:"nrgiGlossaryCtrl"}).when("/contribute",{templateUrl:"/partials/static/contribute"}).when("/about",{templateUrl:"/partials/static/about/about",controller:"nrgiAboutCtrl"}).when("/pie-chart",{templateUrl:"/partials/dynamic/pieChart/pie-chart",controller:"nrgiPieChartCtrl"}).when("/treemap",{templateUrl:"/partials/dynamic/treemap/tree-map"}).when("/sunburst-chart",{templateUrl:"/partials/dynamic/sunburstChart/sunburst-chart"}).when("/sunburst-chart-by-gov",{templateUrl:"/partials/dynamic/sunburstChartByGovEntity/sunburst-chart"}).when("/map",{templateUrl:"/partials/dynamic/map/map"}).otherwise("/",{templateUrl:"/partials/main/main",controller:"nrgiMainCtrl"})}]),angular.module("app").run(["$rootScope","$routeParams","$location","$window",function(a,b,c,d){a._=_,a.Object=Object,a.keys=a.Object.keys,a.$on("$routeChangeError",function(a,b,d,e){document.body.scrollTop=document.documentElement.scrollTop=0,"not authorized"===e&&c.path("/")}),a.$on("$routeChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0;var a=c.path()+"?";angular.forEach(b,function(b,c){a+=c+"="+b+"&"}),a=a.substr(0,a.length-1),d.ga(["_trackPageview",a])})}]),angular.module("app").controller("nrgiLoginCtrl",["$scope","$http","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiAuthSrvc",function(a,b,c,d,e,f){a.identity=e,a.signin=function(a,b){f.authenticateUser(a,b).then(function(a){a?(d.notify("You have successfully signed in!"),c.path("/")):d.error("Username/Password combination incorrect")})}}]),angular.module("app").controller("nrgiProfileCtrl",["$scope","nrgiIdentitySrvc","nrgiUserMethodSrvc","nrgiNotifier",function(a,b,c,d){a.full_name=b.currentUser.first_name+" "+b.currentUser.last_name,a.first_name=b.currentUser.first_name,a.last_name=b.currentUser.last_name,a.email=b.currentUser.email,a.username=b.currentUser.username,a.roles=b.currentUser.roles,a.update=function(){var b={first_name:a.first_name,last_name:a.last_name,email:a.email};a.password&&a.password.length>0&&(b.password=a.password),c.updateUser(b).then(function(){d.notify("Your user account has been updated")},function(a){d.notify(a)})}}]),angular.module("app").controller("nrgiAboutPageUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiAboutPageContentSrvc","nrgiContentMethodSrvc",function(a,b,c,d,e,f){e.get(function(b){a.content=b},function(a){}),a.aboutPageUpdate=function(a){f.updateContentPage(a).then(function(){d.notify("About page has been updated"),c.path("/about")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiGlossaryPageUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiGlossaryPageContentSrvc","nrgiContentMethodSrvc",function(a,b,c,d,e,f){e.get(function(b){a.content=b},function(a){}),a.glossaryPageUpdate=function(a){f.updateContentPage(a).then(function(){d.notify("Glossary page has been updated"),c.path("/glossary")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiLandingPageUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiLandingPageContentSrvc","nrgiContentMethodSrvc",function(a,b,c,d,e,f){e.get(function(b){a.content=b},function(a){}),a.landingPageUpdate=function(a){f.updateContentPage(a).then(function(){d.notify("Landing page has been updated"),c.path("/main")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiCommodityAdminCtrl",["$scope","nrgiCommoditiesSrvc",function(a,b){b.query({skip:0,limit:0},function(b){a.commodities=b.data})}]),angular.module("app").controller("nrgiCommodityAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiCommoditiesMethodSrvc",function(a,b,c,d,e){a.commodity=[],a.commodityCreate=function(){e.createCommodity(a.commodity).then(function(){c.notify("Commodity created!"),b.path("/admin/commodity-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiCommodityAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiCommoditiesMethodSrvc","nrgiCommoditiesSrvc",function(a,b,c,d,e,f){a.commodity=f.get({_id:b.id}),a.commodityUpdate=function(){e.updateCommodity(a.commodity).then(function(){d.notify("Commodity has been updated"),c.path("/admin/commodity-admin")},function(a){d.error(a)})},a.commodityDelete=function(){var b=a.commodity._id;e.deleteCommodity(b).then(function(){d.notify("Commodity has been deleted"),c.path("/admin/commodity-admin")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiCompanyAdminCtrl",["$scope","nrgiCompaniesSrvc",function(a,b){b.query({skip:0,limit:0},function(b){a.companies=b.data})}]),angular.module("app").controller("nrgiCompanyAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiCountriesSrvc","nrgiCompaniesMethodSrvc",function(a,b,c,d,e,f){a.company=[],a.country=e.query({skip:0,limit:0}),a.companyCreate=function(){f.createCompany(a.company).then(function(){c.notify("Company created!"),b.path("/admin/company-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiCompanyAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiCompaniesMethodSrvc","nrgiCompaniesSrvc","nrgiCountriesSrvc",function(a,b,c,d,e,f,g){a.company=f.get({_id:b.id}),a.country=g.query({skip:0,limit:0}),a.companyUpdate=function(){e.updateCompany(a.company).then(function(){d.notify("Company has been updated"),c.path("/admin/company-admin")},function(a){d.error(a)})},a.companyDelete=function(){var b=a.company._id;e.deleteCompany(b).then(function(){d.notify("Company has been deleted"),c.path("/admin/company-admin")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiConcessionAdminCtrl",["$scope","nrgiConcessionsSrvc",function(a,b){b.query({skip:0,limit:0},function(b){a.concessions=b.data})}]),angular.module("app").controller("nrgiConcessionAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiCountriesSrvc","nrgiConcessionsMethodSrvc",function(a,b,c,d,e,f){a.concession=[],a.country=e.query({skip:0,limit:0}),a.concessionCreate=function(){f.createConcession(a.concession).then(function(){c.notify("Concession created!"),b.path("/admin/concession-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiConcessionAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiConcessionsMethodSrvc","nrgiConcessionsSrvc","nrgiCountriesSrvc",function(a,b,c,d,e,f,g){a.concession=f.get({_id:b.id}),a.country=g.query({skip:0,limit:0}),a.concessionUpdate=function(){e.updateConcession(a.concession).then(function(){d.notify("Concession has been updated"),c.path("/admin/concession-admin")},function(a){d.error(a)})},a.concessionDelete=function(){var b=a.concession._id;e.deleteConcession(b).then(function(){d.notify("Concession has been deleted"),c.path("/admin/concession-admin")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiCountryAdminCtrl",["$scope","nrgiCountriesSrvc",function(a,b){b.query({skip:0,limit:0},function(b){a.countries=b.data})}]),angular.module("app").controller("nrgiCountryAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiCountriesSrvc","nrgiCountriesMethodSrvc",function(a,b,c,d,e,f){a.country=[],a.countryCreate=function(){f.createCountry(a.country).then(function(){c.notify("Country created!"),b.path("/admin/country-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiCountryAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiProjectsSrvc","nrgiCountriesMethodSrvc","nrgiCountriesSrvc",function(a,b,c,d,e,f,g){a.country=g.get({_id:b.id}),a.countryUpdate=function(){f.updateCountry(a.country).then(function(){d.notify("Country has been updated"),c.path("/admin/country-admin")},function(a){d.error(a)})},a.countryDelete=function(){var b=a.country._id;f.deleteCountry(b).then(function(){d.notify("Country has been deleted"),c.path("/admin/country-admin")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiDatasetCreateCtrl",["$scope","$location","nrgiNotifier","nrgiDatasetMethodSrvc",function(a,b,c,d){a.datasetCreate=function(){var e={name:a.name,source_url:a.source_url};d.createDataset(e).then(function(){c.notify("New dataset created!"),b.path("/admin/etl/datasets")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiEtlCtrl",["$scope","$route","nrgiDatasetSrvc","nrgiDatasetActionMethodSrvc","nrgiNotifier","nrgiDestroySrvc","$window",function(a,b,c,d,e,f,g){c.query({},function(b){a.datasets=b.data}),a.sort_options=[{value:"name",text:"Sort by Name"},{value:"created",text:"Sort by Date Created"}],a.sort_order=a.sort_options[1].value,a.startAction=function(a,c){var f=null;switch(a){case"import":f="Import from Google Sheets";break;case"unload":f="Unload last import";break;case"cleaned":f="Mark as cleaned"}if("56737e170e8cc07115211ee4"===c&&"import"===a&&(f="Import from Companies House API"),null===f)return void e.error("Invalid dataset action requested!");var g={id:c,name:f};d.createAction(g).then(function(){e.notify('Action "'+f+'" started'),b.reload()},function(a){e.error(a)})},a.dalete_all_data=function(){g.confirm("are you sure?")&&f.query({},function(a){console.log(a)})},a.refresh_data=function(){c.query({},function(b){e.notify("Refresh"),a.datasets=b.data})}}]),angular.module("app").controller("nrgiReconcileCtrl",["$scope","$route","nrgiDuplicatesSrvc","nrgiResolveSrvc",function(a,b,c,d){var e=50,f=0,g=0;a.count=0,a.busy=!1,a.duplicate_companies=[],a.duplicate_projects=[],a.duplicates=[],a.types=[{name:"company"},{name:"project"}],a.type_filter=a.types[0].name;var h=function(){c.query({type:a.type_filter,skip:f,limit:e},function(b){f=0,a.duplicates=[],a.duplicates=b.data,a.count=b.count,g=Math.ceil(b.count/e),f+=1})};h(),a.resolve_duplicate=function(a,b){f=0,g=0,c.query({id:a,action:b},function(a){h()})},a.loadMore=function(){a.busy||(a.busy=!0,f<g&&c.query({type:a.type_filter,skip:f,limit:e},function(b){a.duplicates=_.union(a.duplicates,b.data),f+=1,a.busy=!1}))},a.resolve_all=function(b){a.busy||(a.busy=!0,d.query({type:a.type_filter},function(b){console.log(b),h(),a.busy=!1}))},a.changeTypeFilter=function(b){f=0,g=0,b&&(a.duplicates=[],a.type_filter=b,h())}}]),angular.module("app").controller("nrgiGroupAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiCountriesSrvc","nrgiGroupsMethodSrvc",function(a,b,c,d,e,f){a.group=[],a.country=e.query({skip:0,limit:0}),a.groupCreate=function(){f.createGroup(a.group).then(function(){c.notify("Company group created!"),b.path("/admin/group-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiGroupAdminCtrl",["$scope","nrgiGroupsSrvc",function(a,b){b.query({skip:0,limit:0},function(b){a.groups=b.data})}]),angular.module("app").controller("nrgiGroupAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiGroupsMethodSrvc","nrgiGroupsSrvc",function(a,b,c,d,e,f){a.group=f.get({_id:b.id}),a.groupUpdate=function(){e.updateGroup(a.group).then(function(){d.notify("Company group has been updated"),c.path("/admin/group-admin")},function(a){d.error(a)})},a.groupDelete=function(){var b=a.group._id;e.deleteGroup(b).then(function(){d.notify("Company group has been deleted"),c.path("/admin/group-admin")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiProjectAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiProjectsSrvc","nrgiProjectsMethodSrvc","nrgiCountriesSrvc","nrgiCommoditiesSrvc","$sce",function(a,b,c,d,e,f,g,h,i){a.project=[],a.country=g.query({skip:0,limit:0}),a.commodity=h.query({skip:0,limit:0}),a.projectCreate=function(){f.createProject(a.project).then(function(){c.notify("Project created!"),b.path("/admin/project-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiProjectAdminCtrl",["$scope","nrgiProjectsSrvc",function(a,b){b.query({skip:0,limit:0},function(b){a.projects=b.data})}]),angular.module("app").controller("nrgiProjectAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiProjectsSrvc","nrgiProjectsMethodSrvc","nrgiCountriesSrvc","nrgiCommoditiesSrvc",function(a,b,c,d,e,f,g,h){a.project=e.get({_id:b.id}),a.country=g.query({skip:0,limit:0}),a.commodity=h.query({skip:0,limit:0}),a.projectUpdate=function(){f.updateProject(a.project).then(function(){d.notify("Project has been updated"),c.path("/admin/project-admin")},function(a){d.error(a)})},a.projectDelete=function(){var b=a.project._id;f.deleteProject(b).then(function(){d.notify("Project has been deleted"),c.path("/admin/project-admin")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiSourceAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiProjectsSrvc","nrgiSourcesMethodSrvc",function(a,b,c,d,e,f){var g=[];angular.extend(g,d.currentUser),a.source=[],a.sourceCreate=function(){a.source.create_author=g._id,f.createSource(a.source).then(function(){c.notify("Source created!"),b.path("/admin/source-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiSourceAdminCtrl",["$scope","nrgiSourcesSrvc",function(a,b){b.query({skip:0,limit:0},function(b){a.sources=b.data})}]),angular.module("app").controller("nrgiSourceAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiProjectsSrvc","nrgiSourcesMethodSrvc","nrgiSourcesSrvc",function(a,b,c,d,e,f,g){a.source=[],a.source=g.get({_id:b.id}),a.sourceUpdate=function(){a.source.retrieve_date=new Date,f.updateSource(a.source).then(function(){d.notify("Source has been updated"),c.path("/admin/source-admin")},function(a){d.error(a)})},a.sourceDelete=function(){var b=a.source._id;f.deleteSource(b).then(function(){d.notify("Source has been deleted"),c.path("/admin/source-admin")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiSourceTypeAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiSourceTypesMethodSrvc",function(a,b,c,d){var e=[];a.sourceType=[],a.sourceType.source_type_display={status:!1,name:"No Display"},a.sourceType.source_type_authority="authoritative",a.type_display=[{status:!1,name:"No Display"},{status:!0,name:"Display"}],a.authority=[{key:0,name:"authoritative"},{key:1,name:"non-authoritative"},{key:2,name:"disclosure"}],a.sourceCreate=function(){a.sourceType.source_type_display=a.sourceType.source_type_display.status,a.sourceType.create_author=e._id,d.createSourceType(a.sourceType).then(function(){c.notify("Source Type created!"),b.path("/admin/sourceType-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiSourceTypeAdminCtrl",["$scope","nrgiSourceTypesSrvc",function(a,b){b.query({skip:0,limit:0},function(b){a.sourceTypes=b.sourceTypes})}]),angular.module("app").controller("nrgiSourceTypeAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiProjectsSrvc","nrgiSourceTypesMethodSrvc","nrgiSourceTypesSrvc",function(a,b,c,d,e,f,g){a.sourceType=[],g.get({_id:b.id},function(b){a.sourceType=b,1==a.sourceType.source_type_display?a.sourceType.source_type_display={status:!0,name:"Display"}:a.sourceType.source_type_display={status:!1,name:"No Display"}}),a.authority=[{key:0,name:"authoritative"},{key:1,name:"non-authoritative"},{key:2,name:"disclosure"}],a.type_display=[{status:!0,name:"Display"},{status:!1,name:"No Display"}],a.sourceUpdate=function(){a.sourceType.source_type_display=a.sourceType.source_type_display.status,f.updateSourceType(a.sourceType).then(function(){d.notify("Source Type has been updated"),c.path("/admin/sourceType-admin")},function(a){d.error(a)})},a.sourceDelete=function(){var b=a.sourceType._id;f.deleteSourceType(b).then(function(){d.notify("Source Type has been deleted"),c.path("/admin/sourceType-admin")},function(a){d.error(a)})}}]),angular.module("app").controller("nrgiUserAdminCreateCtrl",["$scope","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiUserSrvc","nrgiUserMethodSrvc",function(a,b,c,d,e,f){a.role_options=[{value:"admin",text:"Administrator"}],a.userCreate=function(){var d={first_name:a.first_name,last_name:a.last_name,username:a.username,email:a.email,password:a.password,roles:[a.role_select],address:[a.address],language:[a.language]};f.createUser(d).then(function(){c.notify("User account created!"),b.path("/admin/user-admin")},function(a){c.error(a)})}}]),angular.module("app").controller("nrgiUserAdminCtrl",["$scope","nrgiUserSrvc",function(a,b){a.users=b.query(),a.sort_options=[{value:"first_name",text:"Sort by First Name"},{value:"last_name",text:"Sort by Last Name"},{value:"username",text:"Sort by Username"},{value:"roles[0]",text:"Sort by Role"}],a.sort_order=a.sort_options[1].value}]),angular.module("app").controller("nrgiUserAdminUpdateCtrl",["$scope","$routeParams","$location","nrgiNotifier","nrgiUserSrvc","nrgiUserMethodSrvc",function(a,b,c,d,e,f){a.user=e.get({_id:b.id}),a.userUpdate=function(){var b=a.user;a.password&&a.password.length>0?a.password===a.password_rep?(b.password=a.password,f.updateUser(b).then(function(){d.notify("User account has been updated")},function(a){d.error(a)})):d.error("Passwords must match!"):f.updateUser(b).then(function(){d.notify("User account has been updated")},function(a){d.error(a)})},a.userDelete=function(){var b=a.user._id;rgiUserMethodSrvc.deleteUser(b).then(function(){c.path("/admin/user-admin"),rgiNotifier.notify("User account has been deleted")},function(a){rgiNotifier.error(a)})}}]),angular.module("app").factory("nrgiCSV",["$filter",function(a){var b,c=[],d="",e="",f="",g="",h="",i="",j="",k=", ";return{setCsv:function(l,m){c=[],angular.forEach(m,function(n,o){c[o]=[],angular.forEach(l,function(p,q){if("transfer_value"==p&&(j="",j=a("currency")(n[p],"",0),c[o].push(j)),"country"==p&&(f="",void 0!=n[p]&&(f=n[p].name.toString(),f=f.charAt(0).toUpperCase()+f.substr(1)),c[o].push(f)),"company"==p&&(e="",void 0!=n[p]&&(e=n[p].company_name.toString(),e=e.charAt(0).toUpperCase()+e.substr(1)),c[o].push(e)),"proj_site_type"==p||"production_level"==p){if(r="",void 0!=n.proj_site&&void 0!=n.proj_site.type)var r=n.proj_site.type.toString();c[o].push(r)}if("proj_site_id"==p){if(s="",void 0!=n.proj_site&&void 0!=n.proj_site._id&&"project"==n.proj_site.type)var s=n.proj_site._id.toString();c[o].push(s)}if("production_commodity"==p&&(n[p]&&n[p].name?(d="",d=n[p].name.toString(),d=d.charAt(0).toUpperCase()+d.substr(1),c[o].push(d)):c[o].push("")),"proj_commodity"==p||"site_commodity"==p||"concession_commodities"==p)if(n[p]&&n[p].length>0){b="";var t=_.uniq(n[p],function(a){if(a)return a._id});angular.forEach(t,function(a,e){d="",void 0!=a&&(d=a.commodity_name.toString(),d=d.charAt(0).toUpperCase()+d.substr(1)),e!=t.length-1?b=b+d+k:(b+=d,c[o].push(b))})}else c[o].push("");if("proj_status"==p||"site_status"==p||"concession_status"==p)if(n[p]&&n[p].timestamp&&n[p].string){b="";var u=new Date(n[p].timestamp);u=a("date")(u,"MM/dd/yyyy @ h:mma");var v=n[p].string.toString();v=v.charAt(0).toUpperCase()+v.substr(1),b=b+v+" (true at "+u+")",c[o].push(b)}else c[o].push("");if("proj_country"==p&&(n[p]&&n[p].length>0?(b="",angular.forEach(n[p],function(a,d){f="",void 0!=a&&(f=a.name.toString(),f=f.charAt(0).toUpperCase()+f.substr(1)),d!=n[p].length-1?b=b+f+k:(b+=f,c[o].push(b))})):c[o].push("")),"company_groups"==p&&(n[p]&&n[p].length>0?(b="",angular.forEach(n[p],function(a,d){g="",void 0!=a&&(g=a.company_group_name.toString(),g=g.charAt(0).toUpperCase()+g.substr(1)),d!=n[p].length-1?b=b+g+k:(b+=g,c[o].push(b))})):c[o].push("")),"concession_country"!=p&&"site_country"!=p||(n[p]?(f="",f=n[p].name.toString(),f=f.charAt(0).toUpperCase()+f.substr(1),c[o].push(f)):c[o].push("")),"companies"==p&&(n[p]&&n[p].length>0?(b="",angular.forEach(n[p],function(a,d){e="",void 0!=a&&(e=a.company_name.toString(),e=e.charAt(0).toUpperCase()+e.substr(1)),d!=n[p].length-1?b=b+e+k:(b+=e,c[o].push(b))})):c[o].push("")),"proj_type"==p)if(n.proj_commodity&&n.proj_commodity.length>0){b="";var w=_.uniq(n.proj_commodity,function(a){if(a)return a.commodity_type});angular.forEach(w,function(d,e){h="",void 0!=d&&(h=a("addSpaces")(d.commodity_type),h=h.charAt(0).toUpperCase()+h.substr(1)),e!=w.length-1?b=b+h+k:(b+=h,c[o].push(b))})}else c[o].push("");if("concession_type"==p)if(n.concession_commodity&&n.concession_commodity.length>0){b="";var x=_.uniq(n.concession_commodity,function(a){return a.commodity_type});angular.forEach(x,function(a,d){h=a.commodity_type.toString(),h=h.charAt(0).toUpperCase()+h.substr(1),d!=x.length-1?b=b+h+k:(b+=h,c[o].push(b))})}else c[o].push("");if("site_commodity_type"==p)if(n.site_commodity&&n.site_commodity.length>0){b="";var y=_.uniq(n.site_commodity,function(a){return a.commodity_type});angular.forEach(y,function(d,e){h=a("addSpaces")(d.commodity_type),h=h.charAt(0).toUpperCase()+h.substr(1),e!=y.length-1?b=b+h+k:(b+=h,c[o].push(b))})}else c[o].push("");if("proj_id"==p&&(s="",void 0!=n.proj_site&&void 0!=n.proj_site._id&&(s=n.proj_site._id.toString()),c[o].push(s)),"project_id"==p&&(s="",void 0!=n&&void 0!=n.proj_id&&(s=n.proj_id.toString()),c[o].push(s)),"proj_site"==p&&(i="",void 0!=n[p]&&void 0!=n[p].name&&(i=n[p].name.toString()),c[o].push(i)),"proj_status"!=p&&"proj_commodity"!=p&&"proj_type"!=p&&"proj_country"!=p&&"companies"!=p&&"site_status"!=p&&"site_commodity"!=p&&"site_commodity_type"!=p&&"site_country"!=p&&"concession_status"!=p&&"concession_commodities"!=p&&"concession_type"!=p&&"concession_country"!=p&&"production_commodity"!=p&&"proj_site"!=p&&"production_level"!=p&&"proj_id"!=p&&"company"!=p&&"company_groups"!=p&&"country"!=p&&"proj_site_type"!=p&&"proj_site_id"!=p&&"transfer_value"!=p&&"project_id"!=p&&c[o].push(n[p]),m.length-1==o&&l.length-1==q)return c})})},getResult:function(){return c}}}]),angular.module("app").filter("sanitize",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("addSpaces",function(){return function(a){if(void 0!==a)return a.replace(/[_]/g," ")}}).filter("addSpace",function(){return function(a){if(void 0!==a)return a.replace(/[,]/g,", ")}}).filter("zpad",function(){return function(a,b){var c=parseInt(a,10);if(b=parseInt(b,10),isNaN(c)||isNaN(b))return a;for(c=""+c;c.length<b;)c="0"+c;return c}}),angular.module("app").value("nrgiToastr",toastr),angular.module("app").factory("nrgiNotifier",["nrgiToastr",function(a){return{notify:function(b){a.success(b),console.log(b)},error:function(b){a.error(b),console.log(b)}}}]),angular.module("app").controller("nrgiCompanyOperationTableCtrl",["$scope","nrgiTablesSrvc","usSpinnerService","nrgiCSV",function(a,b,c,d){a.companies=[],a.openClose=!0,a.loading=!1,a.expression="";var e="";a.csv_company=[];var f,g=[],h=[],i=", ",j=50,k=0,l=[{name:"Name",status:!0,field:"company_name"},{name:"Group",status:a.group,field:"company_groups"},{name:"Stake ",status:a.stake,field:"stake"}];angular.forEach(l,function(a){0!=a.status&&void 0!=a.status&&(g.push(a.name),h.push(a.field))}),a.getHeaderCompany=function(){return g},c.spin("spinner-companyOperation"),a.$watch("id",function(b){"countries_of_operation"==a.type&&void 0!=b&&(c.stop("spinner-companyOperation"),a.companies=b,0==a.companies.length?a.expression="showLast":(a.busy=!1,j=50,k=1)),"countries_of_operation"!=a.type&&void 0!=b&&(a.loading=!1,a.getCompanyOperation(a.id,a.type))}),a.loadMoreCompaniesOfOperation=function(){a.busy||(a.busy=!0,b.query({_id:a.countryid,type:a.type,skip:k*j,limit:j},function(b){a.companies=_.union(a.companies,b.companies),b.companies.length>49?(k+=1,a.busy=!1):a.busy=!0}))},a.loadCompaniesCSV=function(){return d.setCsv(h,a.companies),d.getResult()},a.getAllCompanies=function(){1==a.busy&&a.companies.length>49||a.companies.length<49?setTimeout(function(){angular.element(document.getElementById("loadCompanyCSV")).trigger("click")},0):b.query({_id:a.countryid,type:a.type,skip:0,limit:5e6},function(b){a.companies=b.companies,a.busy=!0,setTimeout(function(){angular.element(document.getElementById("loadCompanyCSV")).trigger("click")},0)})},a.getCompanyOperation=function(d,l){void 0!=a.id&&1==a.openClose&&(0!=a.companies.length&&0!=a.loading||(a.loading=!0,b.get({_id:d,type:l,skip:k*j,limit:j},function(b){a.expression="",a.companies=b.companies,0==b.companies.length&&0==a.companies.length&&(a.expression="showLast"),c.stop("spinner-companyOperation");var d=[{name:"Name",status:!0,field:"company_name"},{name:"Group",status:a.group,field:"company_groups"},{name:"Stake ",status:a.stake,field:"stake"}];angular.forEach(d,function(a){0!=a.status&&void 0!=a.status&&(g.push(a.name),h.push(a.field))}),a.getHeaderCompany=function(){return g},angular.forEach(a.companies,function(b,c){a.csv_company[c]=[],angular.forEach(h,function(d){"company_groups"==d&&(b[d].length>0?(f="",angular.forEach(b[d],function(g,h){e="",void 0!=g&&(e=g.company_group_name.toString(),e=e.charAt(0).toUpperCase()+e.substr(1)),h!=b[d].length-1&&""!=e?f=f+e+i:(f+=e,a.csv_company[c].push(f))})):a.csv_company[c].push("")),"company_groups"!=d&&"stake"!=d&&a.csv_company[c].push(b[d])})})},function(a){c.stop("spinner-companyOperation")})))}}]),angular.module("app").controller("nrgiCompanyTableCtrl",["$scope","nrgiTablesSrvc","usSpinnerService","nrgiCSV",function(a,b,c,d){a.companies=[],a.openClose=!0,a.loading=!1,a.expression="",a.csv_company=[];var e,f=[],g=[],h=", ",i=50,j=0,k="",l=[{name:"Name",status:!0,field:"company_name"},{name:"Group",status:a.group,field:"company_groups"},{name:"Stake ",status:a.stake,field:"stake"}];angular.forEach(l,function(a){0!=a.status&&void 0!=a.status&&(f.push(a.name),g.push(a.field))}),a.getHeaderCompanyInc=function(){return f},c.spin("spinner-company"),a.company_of_operation=[],a.$watch("id",function(b){("country_of_incorporation"==a.type&&void 0!=b||"site"==a.type&&void 0!=b||"concession"==a.type&&void 0!=b||"project"==a.type&&void 0!=b)&&(a.companies=b,c.stop("spinner-company"),0==a.companies.length?a.expression="showLast":(a.busy=!1,i=50,j=1)),"country_of_incorporation"!=a.type&&void 0!=b&&"site"!=a.type&&"concession"!=a.type&&"project"!=a.type&&(a.loading=!1,a.getCompany(a.id,a.type))}),a.loadMoreCompanies=function(){a.busy||(a.busy=!0,b.query({_id:a.countryid,type:a.type,skip:j*i,limit:i},function(b){a.companies=_.union(a.companies,b.companies),b.companies.length>49?(j+=1,a.busy=!1):a.busy=!0}))},a.loadCompaniesIncCSV=function(){return d.setCsv(g,a.companies),d.getResult()},a.getAllCompaniesInc=function(){1==a.busy&&a.companies.length>49||a.companies.length<49?setTimeout(function(){angular.element(document.getElementById("loadCompanyIncCSV")).trigger("click")},0):b.query({_id:a.countryid,type:a.type,skip:0,limit:5e6},function(b){a.companies=b.companies,a.busy=!0,setTimeout(function(){angular.element(document.getElementById("loadCompanyIncCSV")).trigger("click")},0)})},a.getCompany=function(d,l){void 0!=a.id&&1==a.openClose&&(0!=a.companies.length&&0!=a.loading||(a.loading=!0,
b.get({_id:d,type:l,skip:j*i,limit:i},function(b){a.expression="",0==b.companies.length&&0==a.companies.length&&(a.expression="showLast"),a.companies=b.companies,c.stop("spinner-company");var d=[{name:"Name",status:!0,field:"company_name"},{name:"Group",status:a.group,field:"company_groups"},{name:"Stake ",status:a.stake,field:"stake"}];angular.forEach(d,function(a){0!=a.status&&void 0!=a.status&&(f.push(a.name),g.push(a.field))}),a.getHeaderCompany=function(){return f},angular.forEach(a.companies,function(b,c){a.csv_company[c]=[],angular.forEach(g,function(d){"company_groups"==d&&(b[d].length>0?(e="",angular.forEach(b[d],function(f,g){k="",void 0!=f&&(k=f.company_group_name.toString(),k=k.charAt(0).toUpperCase()+k.substr(1)),g!=b[d].length-1&&""!=k?e=e+k+h:(e+=k,a.csv_company[c].push(e))})):a.csv_company[c].push("")),"company_groups"!=d&&"stake"!=d&&a.csv_company[c].push(b[d])})})},function(a){c.stop("spinner-company")})))}}]),angular.module("app").controller("nrgiConcessionTableCtrl",["$scope","$filter","nrgiConcessionTablesSrvc","usSpinnerService","nrgiCSV",function(a,b,c,d,e){a.concessions=[],a.openClose=!0,a.expression="";var f=[],g=[],h=50,i=0,j=[{name:"Name",status:!0,field:"concession_name"},{name:"Country",status:a.country,field:"concession_country"},{name:"Commodity Type ",status:a.type,field:"concession_type"},{name:"Commodity ",status:a.commodity,field:"concession_commodities"},{name:"Status ",status:a.status,field:"concession_status"},{name:"No. Projects ",status:a.projects,field:"projects_count"}];angular.forEach(j,function(a){0!=a.status&&void 0!=a.status&&(f.push(a.name),g.push(a.field))}),a.getHeaderConcessions=function(){return f},d.spin("spinner-concession"),a.$watch("id",function(b){("country"==a.name&&void 0!=b||"company"==a.name&&void 0!=b)&&(a.concessions=b,d.stop("spinner-concession"),0==a.concessions.length?a.expression="showLast":(a.busy=!1,h=50,i=1)),("country"==a.name&&void 0==b||"company"==a.name&&void 0==b)&&(d.stop("spinner-concession"),a.expression="showLast"),"country"!=a.name&&void 0!=b&&"company"!=a.name&&(a.loading=!1,a.getConcessions(a.id,a.name))}),a.loadMoreConcessions=function(){a.busy||(a.busy=!0,c.query({_id:a.countryid,type:a.name,skip:i*h,limit:h},function(b){a.concessions=_.union(a.concessions,b.concessions),b.concessions.length>49?(i+=1,a.busy=!1):a.busy=!0}))},a.loadConcessionsCSV=function(){return e.setCsv(g,a.concessions),e.getResult()},a.getAllConcessions=function(){1==a.busy&&a.concessions.length>49||a.concessions.length<49?setTimeout(function(){angular.element(document.getElementById("loadConcessionCSV")).trigger("click")},0):c.query({_id:a.countryid,type:a.name,skip:0,limit:5e6},function(b){a.concessions=b.concessions,a.busy=!0,setTimeout(function(){angular.element(document.getElementById("loadConcessionCSV")).trigger("click")},0)})},a.getConcessions=function(b,e){void 0!=a.id&&1==a.openClose&&(0!=a.concessions.length&&0!=a.loading||(a.loading=!0,c.get({_id:b,type:e,skip:i*h,limit:h},function(b){a.expression="",0==b.concessions.length&&0==a.concessions.length&&(a.expression="showLast"),a.concessions=b.concessions,d.stop("spinner-concession")},function(a){d.stop("spinner-concession")})))}}]),angular.module("app").controller("nrgiContractTableCtrl",["$scope","nrgiContractTablesSrvc","usSpinnerService","$filter",function(a,b,c,d){a.openClose=!0,a.loading=!1,a.contracts=[],a.expression="",a.csv_contracts=[];var e="",f="",g=[],h=[];c.spin("spinner-contract"),a.$watch("id",function(b){void 0!=b&&(a.loading=!1,setTimeout(function(){a.getContracts(a.id,a.type)},2e3))}),a.getContracts=function(i,j){void 0!=a.id&&1==a.openClose&&(0!=a.contracts.length&&0!=a.loading||(a.loading=!0,b.get({_id:i,type:j},function(b){a.expression="",a.contracts=b.contracts,(0==b.contracts.length||_.isEmpty(b.contracts[0]))&&(a.expression="showLast",a.contracts=[]),c.stop("spinner-contract");var i=[{name:"Name",status:!a.companies,field:"contract_name"},{name:"RC-ID",status:a.companies,field:"_id"},{name:"Country ",status:a.country,field:"contract_country"},{name:"Commodity ",status:a.commodity,field:"contract_commodity"},{name:"RC-ID ",status:!a.companies,field:"_id"},{name:"No. Companies ",status:a.companies,field:"companies"}];angular.forEach(i,function(a){0!=a.status&&void 0!=a.status&&(g.push(a.name),h.push(a.field))}),a.getHeaderContracts=function(){return g},angular.forEach(a.contracts,function(b,c){a.csv_contracts[c]=[],angular.forEach(h,function(g){"contract_country"==g&&(e="",void 0!=b[g]&&(e=b[g].name.toString(),e=e.charAt(0).toUpperCase()+e.substr(1)),a.csv_contracts[c].push(e)),"contract_commodity"==g&&(f="",void 0!=b[g]&&(f=d("addSpace")(b[g].toString())),a.csv_contracts[c].push(f)),"contract_country"!=g&&"contract_commodity"!=g&&a.csv_contracts[c].push(b[g])})})},function(a){console.log(a),c.stop("spinner-contract")})))}}]),angular.module("app").controller("nrgiLeafletCtrl",["$scope","$rootScope","nrgiCountryCoordinatesSrvc",function(a,b,c){a.show=!1,a.center=[],a.polygon=[],a.alldata=[],a.location=[],b.projects=[];var d={openstreetmap:{url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{}}};angular.extend(a,{tiles:d.openstreetmap,defaults:{scrollWheelZoom:!1},controls:{fullscreen:{position:"topleft"}},paths:{polygon:{type:"polygon",latlngs:[],fillColor:"red",weight:2,color:"red"}}}),a.$watch("id",function(b){("country"==a.type&&void 0!=b||"company"==a.type&&void 0!=b)&&(a.alldata=b,a.loadCoordinate(a.alldata,a.polygon)),"country"!=a.type&&void 0!=b&&"company"!=a.type&&a.getCoordinate(b,a.type)}),a.$watch("data",function(b){void 0!=b&&(a.alldata=b,void 0!=b.polygon&&(a.polygon=b.polygon),a.loadCoordinate(b,a.polygon))}),a.getCoordinate=function(b,d){setTimeout(function(){c.get({_id:b,type:d},function(b){a.alldata=b.proj_coordinates,void 0!=b.polygon&&(a.polygon=b.polygon),a.loadCoordinate(a.alldata,a.polygon)})},2e3)},a.loadCoordinate=function(b,c){if(a.polygon=c,1==a.map&&(a.data_loading=!0),a.alldata.length>0)var d=a.alldata.length;var e=0,f=[],g=[];angular.forEach(b,function(b){e++,"site"==b.type?a.location.push({lat:b.lat,lng:b.lng,message:"<a href='site/"+b._id+"'>"+b.message+"</a></br>"+b.message}):"field"==b.type?a.location.push({lat:b.lat,lng:b.lng,message:"<a href='field/"+b._id+"'>"+b.message+"</a></br>"+b.message}):1==a.map?b.coordinates.length>0&&a.location.push(b.coordinates[0]):a.location.push({lat:b.lat,lng:b.lng,message:"<a href='site/"+b._id+"'>"+b.message+"</a></br>"+b.message}),f.push(b.lat),g.push(b.lng),d==e&&1==a.map&&(a.data_loading=!1,a.center={lat:f.reduce(function(a,b){return a+parseInt(b)},0)/f.length,lng:g.reduce(function(a,b){return a+parseInt(b)},0)/g.length,zoom:2}),d==e&&1!=a.map&&a.alldata.length>1&&(a.center={lat:f.reduce(function(a,b){return a+parseInt(b)},0)/f.length,lng:g.reduce(function(a,b){return a+parseInt(b)},0)/g.length,zoom:4}),d==e&&1!=a.map&&1==a.alldata.length&&(a.center={lat:b.lat,lng:b.lng,zoom:3}),a.show=!0}),void 0!=a.polygon&&(a.polygon.length>1&&(angular.forEach(a.polygon,function(b,c){a.paths.polygon.latlngs[c]=b.coordinate}),a.paths.polygon.type="multiPolygon"),1==a.polygon.length&&(a.paths.polygon.type="polygon",a.paths.polygon.latlngs=a.polygon[0].coordinate))}}]),angular.module("app").controller("rgiListNavCtrl",["$scope",function(a){}]),angular.module("app").controller("nrgiMapCtrl",["$scope","$rootScope","nrgiMainMapSrvc","$http","usSpinnerService","$location",function(a,b,c,d,e,f){function g(){d3.xml("../../assets/worldWithAntarcticaHigh.svg",function(b){d3.select(".map_data").node().appendChild(b.documentElement),d3.select("svg").attr("width",q).attr("height",r),"map"!=a.type&&d3.select("g").attr("transform","translate(0,0)scale(0.7)"),d3.select("rect").attr("class","overlay").attr("width",q).attr("height",r).call(p),t=d3.select("g"),a.countries=t.selectAll(".land").attr("project_count",function(){return 0}).attr("transfer_count",function(){return 0}).on("mousemove",i).on("mouseout",j).on("click",k),angular.forEach(a.resourceproject,function(b){angular.forEach(a.countries[0],function(c){c.id==b.iso2&&(d3.select("#"+c.id).attr("class",function(){return u=l(b.project_count),"subunit-boundary subunit Group"+u+" "+c.id}).attr("project_count",function(){return b.project_count}).attr("transfer_count",function(){return b.transfer_count}).on("mousemove",i).on("mouseout",j).on("click",k),v=a.capitals.filter(function(a){return a.iso2===c.id}),v=v[0],v&&(w=d3.select("g").append("circle").attr("class",function(){return u=0,b.transfer_count>0&&(u=1),"bubble-boundary bubble Group"+u+" "+c.id}).attr("transfer_count",function(){return b.transfer_count}).attr("project_count",function(){return b.project_count}).attr("title",function(){return d3.select("#"+c.id).attr("title")}).attr("id",function(){return c.id}).attr("d",a.path).attr("transform",function(a){return x=d3.select("#"+c.id).node(),x.getBBox().width>50&&x.getBBox().height>50?v.lat>=0&&v["long"]>=0?"translate("+[x.getBBox().x+v.lat/2,x.getBBox().y+v["long"]/2]+")":"translate("+[x.getBBox().x+x.getBBox().width-Math.abs(v.lat),x.getBBox().y+x.getBBox().height-Math.abs(v["long"])/2]+")":"translate("+[x.getBBox().x+x.getBBox().width/2,x.getBBox().y+x.getBBox().height/2]+")"}).attr("r",function(a){return m(b.transfer_count)}).on("click",k).on("mousemove",i).on("mouseout",j)))})})}),e.stop("spinner-map")}function h(){t.attr("transform","translate("+p.translate()+")scale("+p.scale()+")"),t.select("land").style("stroke-width",1/p.scale()+"px")}function i(){y=d3.mouse(d3.select("rect").node()).map(function(a){return parseInt(a)}),d3.select(this).style("cursor","pointer"),s.classed("hidden",!1).attr("style","left:"+(y[0]+35)+"px; top:"+y[1]+"px").html("<p>"+d3.select(this).attr("title")+"<br> Projects: "+d3.select(this).attr("project_count")+"<br> Payments:"+d3.select(this).attr("transfer_count")+"</p>")}function j(){t.selectAll("."+d3.select(this).attr("id")),d3.select(this).style("cursor","default"),s.classed("hidden",!0)}function k(){f.path("/country/"+d3.select(this).attr("id")),a.$apply()}function l(a){return a<1?1:a<2?2:a<5?3:a<10?4:a<15?5:a<20?6:a<50?7:a<100?8:a<150?9:10}function m(a){return a<0?0:a<1?4:a<10?5:a<15?6:a<30?7:a<50?8:9}function n(a,b){return d3.transition().duration(350).tween("zoom",function(){var c=d3.interpolate(p.translate(),a),d=d3.interpolate(p.scale(),b);return function(a){p.scale(d(a)).translate(c(a)),h()}})}function o(){var a=(d3.event.target,1),b=.2,c=1,d=[q/2,r/2],e=p.scaleExtent(),f=p.translate(),g=[],h=[],i={x:f[0],y:f[1],k:p.scale()};return d3.event.preventDefault(),a="zoomIn"===this.id?1:-1,c=p.scale()*(1+b*a),!(c<e[0]||c>e[1])&&(g=[(d[0]-i.x)/i.k,(d[1]-i.y)/i.k],i.k=c,h=[g[0]*i.k+i.x,g[1]*i.k+i.y],i.x+=d[0]-h[0],i.y+=d[1]-h[1],void n([i.x,i.y],i.k))}var p=d3.behavior.zoom().scaleExtent([.7,8]).on("zoom",h);e.spin("spinner-map");var q=angular.element(".map_data").width(),r=a.height,s=d3.select(".map_data").append("div").attr("class","hidden tooltip");a.projCheckbox=!0,a.paymentsCheckbox=!0,a.count=2;var t,u,v,w,x,y;c.get({},function(b){b.data&&b.world?(a.resourceproject=b.data,a.capitals=b.world,g()):console.log("Error")}),d3.selectAll("button").on("click",o),d3.select(self.frameElement).style("height",r+"px"),a.checked=function(b,c){0==b?a.count--:a.count++,"paymentsCheckbox"==c&&0==b&&d3.select(".map_data").selectAll(".bubble").attr("class",function(a){return"bubble-boundary bubble Group0 "+d3.select(this).attr("id")}),"projCheckbox"==c&&0==b&&d3.select(".map_data").selectAll(".subunit").attr("class",function(a){return"subunit-boundary subunit Group1 "+d3.select(this).attr("id")}),"projCheckbox"==c&&1==b&&t.selectAll(".subunit").attr("class",function(a){return u=l(d3.select(this).attr("project_count")),"subunit-boundary subunit Group"+u+" "+d3.select(this).attr("id")}),"paymentsCheckbox"==c&&1==b&&t.selectAll(".bubble").attr("class",function(a){return u=0,d3.select(this).attr("transfer_count")>0&&(u=1),"bubble-boundary bubble Group"+u+" "+d3.select(this).attr("id")})}}]),angular.module("app").controller("nrgiProductionTableCtrl",["$scope","nrgiProdTablesSrvc","usSpinnerService","nrgiCSV",function(a,b,c,d){a.production=[],a.loading=!1,a.openClose=!0;var e=[];a.expression="";var f=[],g=[{name:"Year",status:!0,field:"production_year"},{name:"Volume",status:!0,field:"production_volume"},{name:"Unit",status:!0,field:"production_unit"},{name:"Commodity",status:!0,field:"production_commodity"},{name:"Price",status:!0,field:"production_price"},{name:"Price unit",status:!0,field:"production_price_unit"},{name:"Level ",status:!0,field:"production_level"},{name:"Project ID",status:a.projectlink,field:"proj_id"},{name:"Project / Site ",status:a.projectlink,field:"proj_site"}];angular.forEach(g,function(a){0!=a.status&&void 0!=a.status&&(e.push(a.name),f.push(a.field))}),a.getHeaderProduction=function(){return e};var h=50,i=0;c.spin("spinner-production"),a.$watch("id",function(b){("country"==a.type&&void 0==b||"company"==a.type&&void 0==b||"site"==a.type&&void 0==b||"concession"==a.type&&void 0==b||"project"==a.type&&void 0==b)&&(c.stop("spinner-transfers"),a.expression="showLast"),("country"==a.type&&void 0!=b||"company"==a.type&&void 0!=b||"site"==a.type&&void 0!=b||"concession"==a.type&&void 0!=b||"project"==a.type&&void 0!=b)&&(a.production=b,c.stop("spinner-production"),0==a.production.length?a.expression="showLast":(a.busy=!1,i=1)),"country"!=a.type&&void 0!=b&&"company"!=a.type&&"site"!=a.type&&"concession"!=a.type&&"project"!=a.type&&(a.loading=!1,a.getProduction(a.id,a.type))}),a.loadMoreProductions=function(){a.busy||(a.busy=!0,b.query({_id:a.countryid,type:a.type,skip:i*h,limit:h},function(b){a.production=_.union(a.production,b.production),b.production.length>49?(i+=1,a.busy=!1):a.busy=!0}))},a.loadProductionsCSV=function(){return d.setCsv(f,a.production),d.getResult()},a.getAllProductions=function(){1==a.busy&&a.production.length>49||a.production.length<49?setTimeout(function(){angular.element(document.getElementById("loadProductionCSV")).trigger("click")},0):b.query({_id:a.countryid,type:a.type,skip:0,limit:5e6},function(b){a.production=b.production,a.busy=!0,setTimeout(function(){angular.element(document.getElementById("loadProductionCSV")).trigger("click")},0)})},a.getProduction=function(d,e){void 0!=a.id&&1==a.openClose&&(0!=a.production.length&&0!=a.loading||(a.loading=!0,b.get({_id:d,type:e,skip:i*h,limit:h},function(b){a.expression="",0==b.production.length&&0==a.production.length&&(a.expression="showLast"),a.production=b.production,c.stop("spinner-production")},function(a){console.log(a),c.stop("spinner-production")})))}}]),angular.module("app").controller("nrgiProjectTableCtrl",["$scope","nrgiProjectTablesSrvc","usSpinnerService","nrgiCSV",function(a,b,c,d){a.projects=[],a.openClose=!0,a.expression="",a.count=0,a.busy=!0;var e=[],f=[],g=50,h=0,i=[{name:"Project ID",status:!0,field:"project_id"},{name:"Name",status:!0,field:"proj_name"},{name:"Country",status:a.country,field:"proj_country"},{name:"Commodity Type ",status:a.type,field:"proj_type"},{name:"Commodity ",status:a.commodity,field:"proj_commodity"},{name:"Status ",status:a.status,field:"proj_status"},{name:"Companies ",status:a.companies,field:"companies"}];angular.forEach(i,function(a){0!=a.status&&void 0!=a.status&&(e.push(a.name),f.push(a.field))}),a.getHeaderProjects=function(){return e},c.spin("spinner-project"),a.$watch("id",function(b){("country"==a.type&&void 0==b||"company"==a.type&&void 0==b||"concession"==a.type&&void 0==b)&&(c.stop("spinner-project"),a.expression="showLast"),("country"==a.type&&void 0!=b||"company"==a.type&&void 0!=b||"concession"==a.type&&void 0!=b)&&(a.projects=b,c.stop("spinner-project"),0==a.projects.length?a.expression="showLast":(a.busy=!1,g=50,h=1)),"country"!=a.type&&void 0!=b&&"company"!=a.type&&"concession"!=a.type&&(a.loading=!1,a.getProjects(a.id,a.type))}),a.loadMoreProjects=function(){a.busy||(a.busy=!0,b.query({_id:a.countryid,type:a.type,skip:h*g,limit:g},function(b){a.projects=_.union(a.projects,b.projects),b.projects.length>49?(h+=1,a.busy=!1):a.busy=!0}))},a.loadCSV=function(){return d.setCsv(f,a.projects),d.getResult()},a.getAllProjects=function(){1==a.busy&&a.projects.length>49||a.projects.length<49?setTimeout(function(){angular.element(document.getElementById("loadProjectCSV")).trigger("click")},0):b.query({_id:a.countryid,type:a.type,skip:0,limit:5e6},function(b){a.projects=b.projects,a.busy=!0,setTimeout(function(){angular.element(document.getElementById("loadProjectCSV")).trigger("click")},0)})},a.getProjects=function(d,e){void 0!=a.id&&1==a.openClose&&(0!=a.projects.length&&0!=a.loading||(a.loading=!0,b.get({_id:d,type:e,skip:h*g,limit:g},function(b){a.expression="",0==b.projects.length&&0==a.projects.length&&(a.expression="showLast"),a.projects=b.projects,c.stop("spinner-project")},function(a){console.log(a),c.stop("spinner-project")})))}}]),angular.module("app").controller("nrgiSiteTableCtrl",["$scope","$filter","nrgiSiteFieldTablesSrvc","usSpinnerService","nrgiCSV",function(a,b,c,d,e){a.sites=[],a.openClose=!0,a.loading=!1,a.csv_site=[],a.expression="";var f=[],g=[],h=50,i=0,j=[{name:"Name",status:!0,field:"site_name"},{name:"Type",status:a.type,field:"site_type"},{name:"Country",status:a.country,field:"site_country"},{name:"Commodity Type ",status:a.commoditytype,field:"site_commodity_type"},{name:"Commodity ",status:a.commodity,field:"site_commodity"},{name:"Status ",status:a.status,field:"site_status"},{name:"Companies ",status:a.company,field:"companies"}];angular.forEach(j,function(a){0!=a.status&&void 0!=a.status&&(f.push(a.name),g.push(a.field))}),a.getHeaderSites=function(){return f},d.spin("spinner-site"),a.$watch("id",function(b){("country"==a.name&&void 0==b||"company"==a.name&&void 0==b||"concession"==a.name&&void 0==b)&&(d.stop("spinner-site"),a.expression="showLast"),("country"==a.name&&void 0!=b||"company"==a.name&&void 0!=b||"concession"==a.name&&void 0!=b)&&(a.sites=b,d.stop("spinner-site"),0==a.sites.length?a.expression="showLast":(a.busy=!1,h=50,i=1)),"country"!=a.name&&void 0!=b&&"company"!=a.name&&"concession"!=a.name&&(a.loading=!1,a.getSites(a.id,a.name))}),a.loadMoreSites=function(){a.busy||(a.busy=!0,c.query({_id:a.countryid,type:a.name,skip:i*h,limit:h},function(b){a.sites=_.union(a.sites,b.sites),b.sites.length>49?(i+=1,a.busy=!1):a.busy=!0}))},a.loadSitesCSV=function(){return e.setCsv(g,a.sites),e.getResult()},a.getAllSites=function(){1==a.busy&&a.sites.length>49||a.sites.length<49?setTimeout(function(){angular.element(document.getElementById("loadSitesCSV")).trigger("click")},0):c.query({_id:a.countryid,type:a.name,skip:0,limit:5e6},function(b){a.sites=b.sites,a.busy=!0,setTimeout(function(){angular.element(document.getElementById("loadSitesCSV")).trigger("click")},0)})},a.getSites=function(b,e){void 0!=a.id&&1==a.openClose&&(0!=a.sites.length&&0!=a.loading||(a.loading=!0,c.get({_id:b,type:e,skip:i*h,limit:h},function(b){a.expression="",0==b.sites.length&&0==a.sites.length&&(a.expression="showLast"),a.sites=b.sites,d.stop("spinner-site")},function(a){console.log(a),d.stop("spinner-site")})))}}]),angular.module("app").controller("nrgiSourcesTableCtrl",["$scope","nrgiSourceTablesSrvc","usSpinnerService",function(a,b,c){a.sources=[],a.csv_sources=[],a.loading=!1,a.openClose=!0,a.expression="",c.spin("spinner-source"),a.$watch("id",function(b){void 0!=b&&(a.loading=!1,a.getSources(a.id,a.type))}),a.getSources=function(d,e){void 0!=a.id&&1==a.openClose&&(0!=a.sources.length&&0!=a.loading||(a.loading=!0,b.get({_id:d,type:e},function(b){a.expression="",0==b.sources.length&&0==a.sources.length&&(a.expression="showLast"),a.sources=_.uniq(b.sources,function(a){if(a&&a._id)return a._id}),c.stop("spinner-source"),a.getHeaderSources=function(){return["Name","Type","Authority"]},angular.forEach(a.sources,function(b){a.csv_sources.push({name:b.source_name,type:b.source_type_id.source_type_name,authority:b.source_type_id.source_type_authority})})},function(a){console.log(a),c.stop("spinner-source")})))}}]),angular.module("app").controller("nrgiSunburstByGovCtrl",["$scope","nrgiPaymentsByGovSrvc","usSpinnerService",function(a,b,c){a.sunburst=[],a.csv_transfers=[];var d=[],e="",f=[],g="",h="";a.options={chart:{type:"sunburstChart",height:450,color:d3.scale.category20c(),duration:250,mode:"size",noData:"",sunburst:{dispatch:{chartClick:function(a){null==a.pos.target.previousSibling?(e=a.data[0].name.split("<br>"),e=e[1],a.data[0].name="All payments<br>"+e):(e=a.data[0].name.split("<br>"),e=e[1],a.data[0].name="All payments(click to zoom out)<br>"+e)},elementMousemove:function(a){angular.element("path").css("opacity",.3),angular.element(".hover").css("opacity",1)},elementMouseout:function(a){angular.element("path").css("opacity",1)}}},tooltip:{valueFormatter:function(a,b){return""},keyFormatter:function(b,c){return a.currency_filter&&"Show all currency"!=a.currency_filter?b+" "+a.currency_filter:b}}}};var i=[{name:"Year",status:!0,field:"transfer_year"},{name:"Paid by",status:!0,field:"company"},{name:"Paid to",status:!0,field:"country"},{name:"Gov entity",status:!0,field:"transfer_gov_entity"},{name:"Level ",status:!0,field:"transfer_level"},{name:"Payment Type",status:!0,field:"transfer_type"},{name:"Currency",status:!0,field:"transfer_unit"},{name:"Value ",status:!0,field:"transfer_value"}];angular.forEach(i,function(a){0!=a.status&&void 0!=a.status&&(d.push(a.name),f.push(a.field))}),a.getHeaderTransfers=function(){return d},a.year_selector=[],a.currency_selector=[],a.type_selector=[],a.company_selector=[],a.year_filter="2015",a.currency_filter="USD",a.type_filter="Show all types",a.company_filter="Show all companies";var j={transfer_unit:"USD",transfer_year:"2015"};a.load=function(d){c.spin("spinner-sunburst-by-gov"),a.options.chart.noData="",a.sunburst=[],b.query(d,function(b){a.total=0,b.sunburstNew&&b.sunburstNew[0]&&b.sunburstNew[0].children?(a.sunburst=b.sunburstNew,a.total=b.sunburstNew[0].total_value,a.all_currency_value=b.total,a.options.chart.noData="No Data Available.",c.stop("spinner-sunburst-by-gov"),a.csv_transfers=[],angular.forEach(b.transfers,function(b,c){a.csv_transfers[c]=[],angular.forEach(f,function(d){"country"==d&&(g="",void 0!=b[d]&&(g=b[d].name.toString(),g=g.charAt(0).toUpperCase()+g.substr(1)),a.csv_transfers[c].push(g)),"company"==d&&(h="",void 0!=b[d]&&(h=b[d].company_name.toString(),h=h.charAt(0).toUpperCase()+h.substr(1)),a.csv_transfers[c].push(h)),"company"!=d&&"country"!=d&&a.csv_transfers[c].push(b[d])})})):(a.options.chart.noData="No Data Available.",c.stop("spinner-sunburst-by-gov")),b&&b.filters&&(a.year_selector=b.filters.year_selector,a.currency_selector=b.filters.currency_selector,a.type_selector=b.filters.type_selector,a.company_selector=b.filters.company_selector)},function(a){c.stop("spinner-sunburst-by-gov")})},a.load(j),a.$watch("year_filter",function(b){j.transfer_year!=b&&b&&"Show all years"!=b?(j.transfer_year=b,a.load(j)):j.transfer_year&&"Show all years"==b&&(delete j.transfer_year,a.load(j))}),a.$watch("currency_filter",function(b){j.transfer_unit!=b&&b&&"Show all currency"!=b?(j.transfer_unit=b,a.load(j)):j.transfer_unit&&"Show all currency"==b&&(delete j.transfer_unit,a.load(j))}),a.$watch("type_filter",function(b){a.type=b,b&&"Show all types"!=b?(j.transfer_type=b,a.load(j)):j.transfer_type&&"Show all types"==b&&(delete j.transfer_type,a.load(j))}),a.$watch("company_filter",function(b){a.company=b,b&&"Show all companies"!=b?(j.company=b,a.load(j)):j.company&&"Show all companies"==b&&(delete j.company,a.load(j))}),a.$watch("sunburst",function(b){void 0!=a.api&&a.api.refresh()})}]),angular.module("app").controller("nrgiSunburstCtrl",["$scope","nrgiPaymentsSrvc","usSpinnerService",function(a,b,c){a.sunburst=[],a.csv_transfers=[];var d=[],e="",f=[],g="",h="";a.year_selector=[],a.currency_selector=[],a.type_selector=[],a.company_selector=[],a.currency_filter="USD",a.year_filter="2015",a.type_filter="Show all types",a.company_filter="Show all companies";var i={transfer_unit:"USD",transfer_year:"2015"};a.options={chart:{type:"sunburstChart",height:450,color:d3.scale.category20c(),duration:250,mode:"size",noData:"",sunburst:{dispatch:{chartClick:function(a){null==a.pos.target.previousSibling?(e=a.data[0].name.split("<br>"),e=e[1],a.data[0].name="All payments<br>"+e):(e=a.data[0].name.split("<br>"),e=e[1],a.data[0].name="All payments(click to zoom out)<br>"+e)},elementMousemove:function(a){angular.element("path").css("opacity",.3),angular.element(".hover").css("opacity",1)},elementMouseout:function(a){angular.element("path").css("opacity",1)}}},tooltip:{valueFormatter:function(a,b){return""},keyFormatter:function(b,c){return a.currency_filter&&"Show all currency"!=a.currency_filter?b+" "+a.currency_filter:b}}}};var j=[{name:"Year",status:!0,field:"transfer_year"},{name:"Paid by",status:!0,field:"company"},{name:"Paid to",status:!0,field:"country"},{name:"Project",status:!0,field:"proj_site"},{name:"Project ID",status:!0,field:"proj_id"},{name:"Level ",status:!0,field:"transfer_gov_entity"},{name:"Payment Type",status:!0,field:"transfer_type"},{name:"Currency",status:!0,field:"transfer_unit"},{name:"Value ",status:!0,field:"transfer_value"}];angular.forEach(j,function(a){0!=a.status&&void 0!=a.status&&(d.push(a.name),f.push(a.field))}),a.getHeaderTransfers=function(){return d},a.load=function(d){c.spin("spinner-sunburst"),a.options.chart.noData="",a.sunburst=[],b.query(d,function(b){a.total=0,b.sunburstNew&&b.sunburstNew[0]&&b.sunburstNew[0].children?(a.sunburst=b.sunburstNew,a.total=b.sunburstNew[0].total_value,a.all_currency_value=b.total,a.options.chart.noData="No Data Available.",c.stop("spinner-sunburst"),a.csv_transfers=[],angular.forEach(b.transfers,function(b,c){a.csv_transfers[c]=[],angular.forEach(f,function(d){if("country"==d&&(g="",void 0!=b[d]&&(g=b[d].name.toString(),g=g.charAt(0).toUpperCase()+g.substr(1)),a.csv_transfers[c].push(g)),"company"==d&&(h="",void 0!=b[d]&&(h=b[d].company_name.toString(),h=h.charAt(0).toUpperCase()+h.substr(1)),a.csv_transfers[c].push(h)),"proj_site"==d){if(e="",void 0!=b[d]&&void 0!=b[d].name)var e=b[d].name.toString();a.csv_transfers[c].push(e)}if("transfer_gov_entity"==d&&(b[d]&&(e=b[d]),b[d]||(e=void 0!=b.proj_site?b.proj_site.type:""),a.csv_transfers[c].push(e)),"proj_id"==d){if(f="",void 0!=b.proj_site&&void 0!=b.proj_site._id&&"project"==b.proj_site.type)var f=b.proj_site._id.toString();a.csv_transfers[c].push(f)}"company"!=d&&"transfer_gov_entity"!=d&&"country"!=d&&"proj_site"!=d&&"proj_id"!=d&&a.csv_transfers[c].push(b[d])})})):(a.options.chart.noData="No Data Available.",c.stop("spinner-sunburst")),b&&b.filters&&(a.year_selector=b.filters.year_selector,a.currency_selector=b.filters.currency_selector,a.type_selector=b.filters.type_selector,a.company_selector=b.filters.company_selector)},function(a){})},a.load(i),a.$watch("year_filter",function(b){i.transfer_year!=b&&b&&"Show all years"!=b?(i.transfer_year=b,a.load(i)):i.transfer_year&&"Show all years"==b&&(delete i.transfer_year,a.load(i))}),a.$watch("currency_filter",function(b){i.transfer_unit!=b&&b&&"Show all currency"!=b?(i.transfer_unit=b,a.load(i)):i.transfer_unit&&"Show all currency"==b&&(delete i.transfer_unit,a.load(i))}),a.$watch("type_filter",function(b){a.type=b,b&&"Show all types"!=b?(i.transfer_type=b,a.load(i)):i.transfer_type&&"Show all types"==b&&(delete i.transfer_type,a.load(i))}),a.$watch("company_filter",function(b){a.company=b,b&&"Show all companies"!=b?(i.company=b,a.load(i)):i.company&&"Show all companies"==b&&(delete i.company,a.load(i))}),a.$watch("sunburst",function(b){void 0!=a.api&&a.api.refresh()})}]),angular.module("app").controller("nrgiTransferByRecipientTableCtrl",["$scope","nrgiTransferTablesSrvc","usSpinnerService","nrgiCSV",function(a,b,c,d){a.transfers=[],a.loading=!1,a.openClose=!0;var e=[];a.expression="";var f=[],g=50,h=0,i=[{name:"Year",status:!0,field:"transfer_year"},{name:"Paid by",status:!0,field:"company"},{name:"Paid to",status:!0,field:"country"},{name:"Gov entity",status:!0,field:"transfer_gov_entity"},{name:"Level ",status:!0,field:"transfer_level"},{name:"Payment Type",status:!0,field:"transfer_type"},{name:"Currency",status:!0,field:"transfer_unit"},{name:"Value ",status:!0,field:"transfer_value"}];angular.forEach(i,function(a){0!=a.status&&void 0!=a.status&&(e.push(a.name),f.push(a.field))}),a.getHeaderTransfersByRecipient=function(){return e},c.spin("spinner-transfers"),a.$watch("id",function(b){"countries"==a.type&&void 0==b&&(c.stop("spinner-transfers"),a.expression="showLast"),"countries"==a.type&&void 0!=b&&(a.transfers=b,c.stop("spinner-transfers"),0==a.transfers.length?a.expression="showLast":(a.busy=!1,h=1)),"countries"!=a.type&&void 0!=b&&(a.loading=!1,a.getTransfersByRecipient(a.id,a.type))}),a.loadMoreTransfersByRecipient=function(){a.busy||(a.busy=!0,b.query({_id:a.countryid,type:a.type,skip:h*g,limit:g},function(b){a.transfers=_.union(a.transfers,b.transfers),b.transfers.length>49?(h+=1,a.busy=!1):a.busy=!0}))},a.loadPaymentsByRecipientCSV=function(){return d.setCsv(f,a.transfers),d.getResult()},a.getAllPaymentsByRecipient=function(){1==a.busy&&a.transfers.length>49||a.transfers.length<49?setTimeout(function(){angular.element(document.getElementById("loadPaymentByRecipientCSV")).trigger("click")},0):b.query({_id:a.countryid,type:a.type,skip:0,limit:5e6},function(b){a.transfers=b.transfers,a.busy=!0,setTimeout(function(){angular.element(document.getElementById("loadPaymentByRecipientCSV")).trigger("click")},0)})},a.getTransfersByRecipient=function(d,e){void 0!=a.id&&1==a.openClose&&(0!=a.transfers.length&&0!=a.loading||(a.loading=!0,b.get({_id:d,type:e,skip:h*g,limit:g},function(b){a.expression="",0==b.transfers.length&&0==a.transfers.length&&(a.expression="showLast"),a.transfers=b.transfers,c.stop("spinner-transfers")},function(a){console.log(a),c.stop("spinner-transfers")})))}}]),angular.module("app").controller("nrgiTransferTableCtrl",["$scope","nrgiTransferTablesSrvc","usSpinnerService","nrgiCSV",function(a,b,c,d){a.transfers=[],a.loading=!1,a.openClose=!0;var e=[];a.expression="";var f=[],g=50,h=0,i=[{name:"Year",status:!0,field:"transfer_year"},{name:"Paid by",status:!0,field:"company"},{name:"Paid to",status:!0,field:"country"},{name:"Project",status:!0,field:"proj_site"},{name:"Project ID",status:!0,field:"proj_site_id"},{name:"Level ",status:!0,field:"proj_site_type"},{name:"Payment Type",status:!0,field:"transfer_type"},{name:"Currency",status:!0,field:"transfer_unit"},{name:"Value ",status:!0,field:"transfer_value"}];angular.forEach(i,function(a){0!=a.status&&void 0!=a.status&&(e.push(a.name),f.push(a.field))}),a.getHeaderTransfers=function(){return e},c.spin("spinner-transfers"),a.$watch("id",function(b){("country"==a.type&&void 0==b||"company"==a.type&&void 0==b||"project"==a.type&&void 0==b||"site"==a.type&&void 0==b||"concession"==a.type&&void 0==b)&&(c.stop("spinner-transfers"),a.expression="showLast"),("country"==a.type&&void 0!=b||"company"==a.type&&void 0!=b||"site"==a.type&&void 0!=b||"project"==a.type&&void 0!=b||"concession"==a.type&&void 0!=b)&&(a.transfers=b,c.stop("spinner-transfers"),0==a.transfers.length?a.expression="showLast":(a.busy=!1,h=1)),"country"!=a.type&&void 0!=b&&"company"!=a.type&&"site"!=a.type&&"concession"!=a.type&&"project"!=a.type&&(a.loading=!1,a.getTransfers(a.id,a.type))}),a.loadMoreTransfers=function(){a.busy||(a.busy=!0,b.query({_id:a.countryid,type:a.type,skip:h*g,limit:g},function(b){a.transfers=_.union(a.transfers,b.transfers),b.transfers.length>49?(h+=1,a.busy=!1):a.busy=!0}))},a.loadPaymentsCSV=function(){return d.setCsv(f,a.transfers),d.getResult()},a.getAllPayments=function(){1==a.busy&&a.transfers.length>49||a.transfers.length<49?setTimeout(function(){angular.element(document.getElementById("loadPaymentCSV")).trigger("click")},0):b.query({_id:a.countryid,type:a.type,skip:0,limit:5e6},function(b){a.transfers=b.transfers,a.busy=!0,setTimeout(function(){angular.element(document.getElementById("loadPaymentCSV")).trigger("click");
},0)})},a.getTransfers=function(d,e){void 0!=a.id&&1==a.openClose&&(0!=a.transfers.length&&0!=a.loading||(a.loading=!0,b.get({_id:d,type:e,skip:h*g,limit:g},function(b){a.expression="",0==b.transfers.length&&0==a.transfers.length&&(a.expression="showLast"),a.transfers=b.transfers,c.stop("spinner-transfers")},function(a){console.log(a),c.stop("spinner-transfers")})))}}]),angular.module("app").controller("nrgiTreeMapCtrl",["$scope","$rootScope","nrgiTreeMapSrvc","$http","usSpinnerService",function(a,b,c,d,e){function f(a){a.x=a.y=0,a.dx=q,a.dy=r}function g(a){return a.children?a.size=a.children.reduce(function(a,b){return a+g(b)},0):a.size}function h(b){if(b.children){var c=_.map(_.groupBy(b.children,function(a){if(""!=a.name)return a.name}),function(a){var b=_.reduce(a,function(a,b){return a+b.value},0);return a[0].value=b,a[0]});c.length>0&&(a.treemap.nodes({children:c}),c.forEach(function(a){a.x=b.x+a.x*b.dx,a.y=b.y+a.y*b.dy,a.dx*=b.dx,a.dy*=b.dy,a.parent=b,h(a)}))}}function i(b){function c(b){if(!o&&b){o=!0,"Payments"==b.name?d3.select(".back_button").style("visibility","hidden"):d3.select(".back_button").style("visibility","visible");var c=i(b),e=d.transition().duration(750),f=c.transition().duration(750);s.domain([b.x,b.x+b.dx]),t.domain([b.y,b.y+b.dy]),a.svg.style("shape-rendering",null),c.selectAll("text").style("fill-opacity",0),c.selectAll("foreignObject div").style("display","none"),e.selectAll("text").call(j).style("fill-opacity",0),f.selectAll("text").call(j).style("fill-opacity",1),e.selectAll("rect").call(k),f.selectAll("rect").call(k),e.selectAll(".textdiv").style("display","none"),e.selectAll(".foreignobj").call(l),f.selectAll(".textdiv").style("display","block"),f.selectAll(".foreignobj").call(l),e.remove().each("end",function(){a.svg.style("shape-rendering","crispEdges"),o=!1})}}a.grandparent.datum(b.parent).on("click",c).select("text").html(m(b));var d=a.svg.insert("g",".grandparent").datum(b),e=d.selectAll("g").data(b.children).enter().append("g").on("mousemove",w).on("mouseout",x);return e.filter(function(a){return a.children}).classed("children",!0).on("click",c),e.filter(function(a){return a}).classed("children",!0),e.selectAll(".child").data(function(a){return a.children||[a]}).enter().append("rect").attr("class","child").call(k),e.append("rect").attr("class","parent").call(k),e.append("foreignObject").call(k).attr("class","foreignobj").append("xhtml:div").attr("dy",".75em").html(function(a){return'<i style="font-size: 10px;">Payment:</i> </br>'+a.name+"</br> <b>"+(a.value/1e6).toFixed(1)+" Million</b>"}).attr("class","textdiv"),e}function j(a){a.attr("x",function(a){return s(a.x)+6}).attr("y",function(a){return t(a.y)+6})}function k(a){a.attr("x",function(a){return s(a.x)}).attr("y",function(a){return t(a.y)}).attr("width",function(a){return s(a.x+a.dx)-s(a.x)}).attr("height",function(a){return t(a.y+a.dy)-t(a.y)}).style("background",function(a){return a.parent?u(a.name):null})}function l(a){a.attr("x",function(a){return s(a.x)}).attr("y",function(a){return t(a.y)}).attr("width",function(a){return s(a.x+a.dx)-s(a.x)}).attr("height",function(a){return t(a.y+a.dy)-t(a.y)})}function m(a){return a.parent,a.parent?m(a.parent)+" > "+a.name:a.name}a.sunburst=[],a.currency_filter="USD",a.year_filter="2015";var n={transfer_year:"2015",transfer_unit:"USD"};a.show_total=!0,a.load=function(b){e.spin("spinner-treemap"),$(".tree-map-data").empty(),c.query(b,function(b){b.sunburstNew&&b.sunburstNew[0].children&&b.sunburstNew[0].children.length>0?(a.year_selector=b.filters.year_selector,a.currency_selector=b.filters.currency_selector,a.show_total=!0,a.treemapData=b.sunburstNew[0],a.total=b.sunburstNew[0].total_value,a.all_currency_value=b.total,e.stop("spinner-treemap"),v(a.treemapData)):(a.treemapData=[],a.show_total=!1,e.stop("spinner-treemap"))})},a.load(n),parent.document.getElementsByTagName("iframe")[0]&&parent.document.getElementsByTagName("iframe")[0].setAttribute("style","height: 700px !important");var o,p={top:20,right:0,bottom:0,left:0},q=$(".container").innerWidth(),r=600-p.top-p.bottom,s=(d3.format(",d"),d3.scale.linear().domain([0,q]).range([0,q])),t=d3.scale.linear().domain([0,r]).range([0,r]),u=d3.scale.category20c();a.$watch("year_filter",function(b){b&&"Show all years"!=b&&n.transfer_year!=b?(n.transfer_year=b,a.load(n)):n.transfer_year&&"Show all years"==b&&(delete n.transfer_year,a.load(n))}),a.$watch("currency_filter",function(b){b&&"Show all currency"!=b&&n.transfer_unit!=b?(n.transfer_unit=b,a.load(n)):n.transfer_unit&&"Show all currency"==b&&(delete n.transfer_unit,a.load(n))});var v=function(b){a.treemap=d3.layout.treemap().children(function(a){return a.children}).sort(function(a,b){return a.size-b.size}).ratio(r/q*.5*(1+Math.sqrt(5))).round(!1),a.svg=d3.select(".tree-map-data").append("svg").attr("width",q+p.left+p.right).attr("height",r+p.bottom+p.top).style("margin-left",-p.left+"px").style("margin.right",-p.right+"px").append("g").attr("transform","translate("+p.left+","+p.top+")").style("shape-rendering","crispEdges"),a.grandparent=a.svg.append("g").attr("class","grandparent"),a.grandparent.append("rect").attr("y",-p.top).attr("width",q).attr("height",p.top),a.grandparent.append("text").attr("x",6).attr("y",6-p.top).attr("dy",".75em"),a.grandparent.append("text").attr("font-size",function(a){return"x-large"}).attr("class","back_button").attr("x",q-30).attr("y",-1).text(function(a){return"⬅"}),f(b),g(b),h(b),i(b)},w=function(a){var b=d3.event.pageX+5,c=d3.event.pageY+5;d3.selectAll(".children").style("opacity",.5),d3.event.target&&d3.event.target.parentNode&&"g"==d3.event.target.parentNode.nodeName&&d3.select(d3.event.target.parentNode).style("opacity",1),d3.event.target&&d3.event.target.parentNode&&d3.event.target.parentNode.parentNode&&"g"==d3.event.target.parentNode.parentNode.nodeName&&d3.select(d3.event.target.parentNode.parentNode).style("opacity",1),d3.event.target&&d3.event.target.parentNode&&d3.event.target.parentNode.parentNode&&d3.event.target.parentNode.parentNode.parentNode&&"g"==d3.event.target.parentNode.parentNode.parentNode.nodeName&&d3.select(d3.event.target.parentNode.parentNode.parentNode).style("opacity",1),d3.select("#tooltip").style("left",b+"px").style("top",c+"px"),d3.select("#tooltip").html('<span class="text-center"><i style="font-size: 12px;">Payment:</i> </br>'+a.name+"</br> <b>"+(a.value/1e6).toFixed(1)+" Million</b></p>"),d3.select("#tooltip").style("visibility","visible")},x=function(){d3.selectAll(".children").style("opacity",1),d3.select("#tooltip").style("visibility","hidden")}}]),angular.module("app").directive("nrgiCompanyOperationTable",function(){return{restrict:"EA",controller:"nrgiCompanyOperationTableCtrl",scope:{group:"=",countryid:"=",type:"=",stake:"=",project:"=",site:"=",contract:"=",concession:"=",incorporated:"=",operation:"=",id:"="},templateUrl:"/partials/directives/templates/nrgi-company-of-operation-table"}}),angular.module("app").directive("nrgiCompanyTable",function(){return{restrict:"EA",controller:"nrgiCompanyTableCtrl",scope:{group:"=",type:"=",stake:"=",project:"=",countryid:"=",site:"=",contract:"=",concession:"=",incorporated:"=",operation:"=",id:"="},templateUrl:"/partials/directives/templates/nrgi-company-table"}}),angular.module("app").directive("nrgiConcessionTable",function(){return{restrict:"EA",controller:"nrgiConcessionTableCtrl",scope:{commodity:"=",country:"=",countryid:"=",type:"=",status:"=",projects:"=",name:"=",id:"="},templateUrl:"/partials/directives/templates/nrgi-concession-table"}}),angular.module("app").directive("nrgiContractTable",function(){return{restrict:"EA",controller:"nrgiContractTableCtrl",scope:{type:"=",id:"=",companies:"=",commodity:"=",country:"="},templateUrl:"/partials/directives/templates/nrgi-contract-table"}}),angular.module("app").directive("iframeOnload",[function(){return{scope:{callBack:"&iframeOnload"},link:function(a,b,c){b.on("load",function(){return a.callBack()})}}}]),angular.module("app").directive("nrgiLeaflet",function(){return{restrict:"EA",controller:"nrgiLeafletCtrl",scope:{project:"=",map:"=",site:"=",data:"=",id:"=",type:"="},templateUrl:"/partials/directives/templates/nrgi-leaflet"}}),angular.module("app").directive("nrgiListNav",function(){return{restrict:"E",scope:{page:"=",type:"=",show:"=",count:"=",limit:"=",last:"=",first:"=",prev:"=",next:"=",select:"="},templateUrl:"/partials/directives/templates/nrgi-list-nav",link:function(a){a.lastPage=function(){a.last(a.page)},a.firstPage=function(){a.first(a.page)},a.prevPage=function(){a.prev(a.page)},a.nextPage=function(){a.next(a.page,a.show)},a.selectLimit=function(){a.select(a.limit)}}}}),angular.module("app").directive("nrgiMap",function(){return{restrict:"EA",controller:"nrgiMapCtrl",scope:{height:"=",type:"="},templateUrl:"/partials/directives/templates/nrgi-map"}}),angular.module("app").directive("nrgiProductionTable",function(){return{restrict:"EA",controller:"nrgiProductionTableCtrl",scope:{projectlink:"=",id:"=",countryid:"=",type:"="},templateUrl:"/partials/directives/templates/nrgi-production-table"}}),angular.module("app").directive("nrgiProjectTable",function(){return{restrict:"EA",controller:"nrgiProjectTableCtrl",scope:{country:"=",type:"=",commoditytype:"=",countryid:"=",companies:"=",commodity:"=",status:"=",id:"="},templateUrl:"/partials/directives/templates/nrgi-project-table"}}),angular.module("app").directive("whenScrolled",function(){return{restrict:"EA",link:function(a,b,c){var d=b[0];b.bind("scroll",function(){d.scrollTop+d.offsetHeight+5>=d.scrollHeight&&(a.loading=!0,a.$apply(c.whenScrolled))})}}}),angular.module("app").directive("nrgiSiteTable",function(){return{restrict:"EA",controller:"nrgiSiteTableCtrl",scope:{name:"=",id:"=",commodity:"=",status:"=",countryid:"=",country:"=",type:"=",commoditytype:"=",company:"="},templateUrl:"/partials/directives/templates/nrgi-site-table"}}),angular.module("app").directive("nrgiSourcesTable",function(){return{restrict:"EA",controller:"nrgiSourcesTableCtrl",scope:{id:"=",type:"="},templateUrl:"/partials/directives/templates/nrgi-sources-table"}}),angular.module("app").directive("nrgiSunburstByGov",function(){return{restrict:"EA",controller:"nrgiSunburstByGovCtrl",templateUrl:"/partials/directives/templates/nrgi-sunburst-by-gov"}}),angular.module("app").directive("nrgiSunburst",function(){return{restrict:"EA",controller:"nrgiSunburstCtrl",templateUrl:"/partials/directives/templates/nrgi-sunburst"}}),angular.module("app").directive("nrgiTransferByRecipientTable",function(){return{restrict:"EA",controller:"nrgiTransferByRecipientTableCtrl",scope:{id:"=",type:"=",countryid:"="},templateUrl:"/partials/directives/templates/nrgi-transfer-by-recipient-table"}}),angular.module("app").directive("nrgiTransferTable",function(){return{restrict:"EA",controller:"nrgiTransferTableCtrl",scope:{id:"=",type:"=",project:"=",countryid:"=",projectlink:"="},templateUrl:"/partials/directives/templates/nrgi-transfer-table"}}),angular.module("app").directive("nrgiTreeMap",function(){return{restrict:"EA",controller:"nrgiTreeMapCtrl",scope:{data:"="},templateUrl:"/partials/directives/templates/nrgi-tree-map"}}),angular.module("app").directive("navigate",function(){return{restrict:"E",scope:{page:"=",show:"=",count:"=",limit:"=",last:"=",first:"=",prev:"=",next:"=",select:"="},template:'<div class="dropdown"><div class="col-md-12"><div class="pager"><ul class="inline"><li><button class="btn btn-link navigate" ng-disabled="page==0" ng-click="firstPage()"> << </button></li><li><button class="btn btn-link navigate" ng-disabled="page==0" ng-click="prevPage(page)"> < </button></li><li>Showing {{page}} to {{show}} of {{count}} projects. Number of records per page:<form class="inline"><select name="limit" ng-model="limit" ng-change="selectLimit(limit)"><option selected="">50</option><option>200</option><option>1000</option></select></form></li><li><button class="btn btn-link navigate" ng-disabled="show>=count" ng-click="nextPage(page,show)"> > </button></li><li><button class="btn btn-link navigate" ng-disabled="show>=count" ng-click="lastPage()"> >> </button></li></ul></div></div></div>',link:function(a){a.lastPage=function(){a.last(a.page)},a.firstPage=function(){a.first(a.page)},a.prevPage=function(){a.prev(a.page)},a.nextPage=function(){a.next(a.page,a.show)},a.selectLimit=function(){a.select(a.limit)}}}}),angular.module("app").controller("nrgiCommodityDetailCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiCommoditiesSrvc","$routeParams",function(a,b,c,d,e,f){e.get({_id:f.id},function(b){a.commodity=b.commodity,a.id=b.commodity._id})}]),angular.module("app").controller("nrgiCommodityListCtrl",["$scope","$rootScope","nrgiNotifier","nrgiCommoditiesSrvc",function(a,b,c,d){var e=50,f=0,g=0;a.csv_commodities=[];var h=["commodity_name","projects"],i=["Name","No. Projects"];a.getHeaderCommodities=function(){return i},a.count=0,a.busy=!1,a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_commodities[c]=[],angular.forEach(h,function(d){a.csv_commodities[c].push(b[d])})})},d.query({skip:f*e,limit:e},function(b){a.count=b.count,a.commodities=b.commodities,g=Math.ceil(b.count/e),f+=1,a.createDownloadList(a.commodities)}),a.loadMore=function(){a.busy||(a.busy=!0,f<g&&d.query({skip:f*e,limit:e},function(b){a.commodities=_.union(a.commodities,b.commodities),f+=1,a.busy=!1,a.createDownloadList(a.commodities)}))}}]),angular.module("app").controller("nrgiCompanyDetailCtrl",["$scope","$routeParams","nrgiCompaniesSrvc","nrgiCompanyDataSrvc",function(a,b,c,d){a.company=[],c.get({_id:b.id},function(b){b.company?(a.company=b.company,a.id=b.company._id):console.log(b.errorList)}),d.get({_id:b.id},function(b){a.data=b,a.company.company_groups=[],a.company.company_commodity=[],angular.forEach(b.company_groups,function(b){a.company.company_groups.push(b)}),angular.forEach(b.company_commodity,function(b){a.company.company_commodity.push(b)})})}]),angular.module("app").controller("nrgiCompanyListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiCompaniesSrvc",function(a,b,c,d,e){var f=50,g=0,h=0;a.count=0,a.busy=!1;var i,j,k=", ";a.csv_companies=[];var l=["company_name","company_groups","project_count","site_count","field_count","transfer_count"],m=["Company","Group(s)","Projects","Sites","Fields","Payments"];a.getHeaderCompanies=function(){return m},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_companies[c]=[],angular.forEach(l,function(d){"company_groups"==d&&(void 0!=b[d]&&b[d].length>0?(j="",angular.forEach(b[d],function(e,f){i="",void 0!=e&&e.company_group_name&&(i=e.company_group_name.toString(),i=i.charAt(0).toUpperCase()+i.substr(1)),f!=b[d].length-1&&""!=i?j=j+i+k:(j+=i,a.csv_companies[c].push(j))})):a.csv_companies[c].push("")),"company_groups"!=d&&a.csv_companies[c].push(b[d])})})},e.query({skip:g*f,limit:f},function(b){a.count=b.company_count,a.companies=b.companies,h=Math.ceil(b.company_count/f),g+=1,a.createDownloadList(a.companies)}),a.loadMore=function(){a.busy||(a.busy=!0,g<h&&e.query({skip:g*f,limit:f},function(b){a.companies=_.union(a.companies,b.companies),g+=1,a.busy=!1,a.createDownloadList(a.companies)}))}}]),angular.module("app").controller("nrgiConcessionDetailCtrl",["$scope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiConcessionsSrvc","nrgiConcessionDataSrvc","$routeParams",function(a,b,c,d,e,f){d.get({_id:f.id},function(b){a.concession=b.concession,a.id=f.id}),e.get({_id:f.id},function(b){a.data=b})}]),angular.module("app").controller("nrgiConcessionListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiConcessionsSrvc","$filter",function(a,b,c,d,e,f){var g=50,h=0,i=0;a.count=0,a.busy=!1;var j,k,l,m,n,o,p=", ";a.csv_concessions=[];var q=["concession_name","concession_country","commodity_type","concession_commodity","concession_status","project_count","site_count","field_count","transfer_count","production_count"],r=["Name","Country","Commodity Type","Commodity","Status","Projects","Sites","Fields","Payment records","Production records"];a.getHeaderConcessions=function(){return r},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_concessions[c]=[],angular.forEach(q,function(d){"concession_country"==d&&(void 0!=b[d]&&b[d].length>0?(o="",angular.forEach(b[d],function(e,f){j="",void 0!=e&&e.name&&(j=e.name.toString(),j=j.charAt(0).toUpperCase()+j.substr(1)),f!=b[d].length-1&&""!=j?o=o+j+p:(o+=j,a.csv_concessions[c].push(o))})):a.csv_concessions[c].push("")),"concession_commodity"==d&&(void 0!=b[d]&&b[d].length>0?(o="",b[d]=_.map(_.groupBy(b[d],function(a){if(a&&a.commodity_name)return a.commodity_name}),function(a){return a[0]}),angular.forEach(b[d],function(e,f){n="",void 0!=e&&e.commodity_name&&(n=e.commodity_name.toString(),n=n.charAt(0).toUpperCase()+n.substr(1)),f!=b[d].length-1&&""!=n?o=o+n+p:(o+=n,a.csv_concessions[c].push(o))})):a.csv_concessions[c].push("")),"concession_status"==d&&(void 0!=b[d]&&b[d].length>0?(o="",angular.forEach(b[d],function(b,d){k="",void 0!=b&&(k=b.string.toString(),k=k.charAt(0).toUpperCase()+k.substr(1),l=f("date")(b.timestamp,"MM/dd/yyyy @ h:mma"),o=k+"(true at "+l+")",a.csv_concessions[c].push(o))})):a.csv_concessions[c].push("")),"commodity_type"==d&&(void 0!=b.concession_commodity&&b.concession_commodity.length>0?(o="",b.concession_commodity=_.map(_.groupBy(b.concession_commodity,function(a){if(a&&a.commodity_type)return a.commodity_type}),function(a){return a[0]}),angular.forEach(b.concession_commodity,function(d,e){m="",void 0!=d&&d.commodity_type&&(m=d.commodity_type.toString(),m=m.charAt(0).toUpperCase()+m.substr(1)),e!=b.concession_commodity.length-1&&""!=m?o=o+m+p:(o+=m,a.csv_concessions[c].push(o))})):a.csv_concessions[c].push("")),"concession_country"!=d&&"commodity_type"!=d&&"concession_commodity"!=d&&"concession_status"!=d&&a.csv_concessions[c].push(b[d])})})},e.query({skip:h*g,limit:g},function(b){a.count=b.count,a.concessions=b.concessions,i=Math.ceil(b.count/g),h+=1,a.createDownloadList(a.concessions)}),a.loadMore=function(){a.busy||(a.busy=!0,h<i&&e.query({skip:h*g,limit:g},function(b){a.concessions=_.union(a.concessions,b.concessions),h+=1,a.busy=!1,a.createDownloadList(a.concessions)}))}}]),angular.module("app").controller("nrgiContractDetailCtrl",["$scope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiContractsSrvc","$routeParams",function(a,b,c,d,e){d.get({_id:e.id},function(b){a.contract=b})}]),angular.module("app").controller("nrgiContractListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","$sce","nrgiContractsSrvc",function(a,b,c,d,e,f){var g=50,h=0,i=0;a.count=0,a.busy=!1;var j,k,l,m,n,o=", ";a.csv_contracts=[];var p=["contract_id","rc_info","contract_type","commodity_type","commodity","projects","sites","fields"],q=["RC-ID","Country","Contract Type","Commodity Type","Commodity","Projects","Sites","Fields"];a.getHeaderContracts=function(){return q},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_contracts[c]=[],angular.forEach(p,function(d){"rc_info"==d&&(void 0!=b[d]&&b[d].length>0?(n="",angular.forEach(b[d],function(e,f){j="",void 0!=e&&void 0!=e.contract_country&&(j=e.contract_country.name.toString(),j=j.charAt(0).toUpperCase()+j.substr(1)),f!=b[d].length-1&&""!=j?n=n+j+o:(n+=j,a.csv_contracts[c].push(n))})):a.csv_contracts[c].push("")),"contract_type"==d&&(void 0!=b.rc_info&&b.rc_info.length>0?(n="",angular.forEach(b.rc_info,function(d,e){k="",void 0!=d&&void 0!=d.contract_type&&(k=d.contract_type.toString(),k=k.charAt(0).toUpperCase()+k.substr(1)),e!=b.rc_info.length-1&&""!=k?n=n+k+o:(n+=k,a.csv_contracts[c].push(n))})):a.csv_contracts[c].push("")),"commodity_type"==d&&(void 0!=b.commodity&&b.commodity.length>0?(n="",b.commodity=_.map(_.groupBy(b.commodity,function(a){return a.commodity_type}),function(a){return a[0]}),angular.forEach(b.commodity,function(d,e){l="",void 0!=d&&void 0!=d.commodity_type&&(l=d.commodity_type.toString(),l=l.charAt(0).toUpperCase()+l.substr(1)),e!=b.commodity.length-1&&""!=l?n=n+l+o:(n+=l,a.csv_contracts[c].push(n))})):a.csv_contracts[c].push("")),"commodity"==d&&(void 0!=b[d]&&b[d].length>0?(n="",b[d]=_.map(_.groupBy(b[d],function(a){return a.commodity_name}),function(a){return a[0]}),angular.forEach(b[d],function(e,f){m="",void 0!=e&&void 0!=e.commodity_type&&(m=e.commodity_name.toString(),m=m.charAt(0).toUpperCase()+m.substr(1)),f!=b[d].length-1&&""!=m?n=n+m+o:(n+=m,a.csv_contracts[c].push(n))})):a.csv_contracts[c].push("")),"rc_info"!=d&&"contract_type"!=d&&"commodity_type"!=d&&"commodity"!=d&&a.csv_contracts[c].push(b[d])})})},f.query({skip:h*g,limit:g},function(b){a.count=b.count,a.contracts=b.data,i=Math.ceil(b.count/g),h+=1,a.createDownloadList(a.contracts)}),a.loadMore=function(){a.busy||(a.busy=!0,h<i&&f.query({skip:h*g,limit:g},function(b){a.contracts=_.union(a.contracts,b.data),h+=1,a.busy=!1,a.createDownloadList(a.contracts)}))}}]),angular.module("app").controller("nrgiCountryDetailCtrl",["$scope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiCountriesSrvc","nrgiCountryCommoditiesSrvc","$routeParams",function(a,b,c,d,e,f){d.get({_id:f.id},function(b){b.error||(a.country=b.country,a.country.commodities=b.commodities,a.id=b.country._id)}),a.$watch("country._id",function(b){void 0!=b&&e.get({_id:b},function(b){a.data=b})})}]),angular.module("app").controller("nrgiCountryListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","$sce","nrgiCountriesSrvc",function(a,b,c,d,e,f){var g=300,h=0,i=0;a.count=0,a.busy=!1,a.csv_countries=[];var j=["name","project_count","site_count","field_count","concession_count","transfer_count"],k=["Country","Projects","Sites","Fields","Concessions","Payments"];a.getHeaderCountries=function(){return k},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_countries[c]=[],angular.forEach(j,function(d){a.csv_countries[c].push(b[d])})})},f.query({skip:h*g,limit:g},function(b){a.count=b.count,a.countries=b.countries,i=Math.ceil(b.count/g),++h,a.createDownloadList(a.countries)})}]),angular.module("app").controller("nrgiGroupDetailCtrl",["$scope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiGroupsSrvc","nrgiGroupDataSrvc","$routeParams",function(a,b,c,d,e,f){a.group=[],d.get({_id:f.id},function(b){a.group=b}),e.get({_id:f.id},function(b){a.group.companies=[],a.group.commodities=[],angular.forEach(b.companies,function(b){a.group.companies.push(b)}),angular.forEach(b.commodities,function(b){a.group.commodities.push(b)})})}]),angular.module("app").controller("nrgiGroupListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiGroupsSrvc",function(a,b,c,d,e){var f=50,g=0,h=0;a.count=0,a.busy=!1,a.csv_groups=[];var i=["company_group_name","company_count","project_count"],j=["Company Group","Companies","Projects"];a.getHeaderGroups=function(){return j},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_groups[c]=[],angular.forEach(i,function(d){a.csv_groups[c].push(b[d])})})},e.query({skip:g*f,limit:f},function(b){a.count=b.count,a.groups=b.data,h=Math.ceil(b.count/f),g+=1,a.createDownloadList(a.groups)}),a.loadMore=function(){a.busy||(a.busy=!0,g<h&&e.query({skip:g*f,limit:f},function(b){a.groups=_.union(a.groups,b.data),g+=1,a.busy=!1,a.createDownloadList(a.groups)}))}}]),angular.module("app").controller("nrgiPieChartCtrl",["$scope","nrgiPieChartSrvc","usSpinnerService",function(a,b,c){a.currency_filter="USD",a.year_filter="2015";var d={transfer_unit:a.currency_filter,transfer_year:a.year_filter};a.options={chart:{type:"pieChart",height:500,x:function(a){return a.key+", "+a.value.toFixed(1)},y:function(b){return 100*b.value/a.total},showLabels:!1,duration:500,labelThreshold:.01,labelSunbeamLayout:!0,noData:"",showLegend:!1,tooltip:{valueFormatter:function(a,b){return a.toFixed(3)+"%"},keyFormatter:function(b,c){return b+" million "+a.currency_filter}}}},a.load=function(d){c.spin("spinner-pie-chart"),a.options.chart.noData="",a.pie=[],b.query(d,function(b){a.total=0,b.data?(a.pie=b.data[0].children,a.total=b.data[0].total_value.toFixed(1),a.count=b.data[0].count,a.options.chart.noData="No Data Available.",c.stop("spinner-pie-chart")):(a.options.chart.noData="No Data Available.",c.stop("spinner-pie-chart")),a.year_selector=b.filters.year_selector,a.currency_selector=b.filters.currency_selector})},a.load(d),a.$watch("year_filter",function(b){a.year=b,b&&b!=d.transfer_year&&(d.transfer_year=b,a.currency&&(d.transfer_unit=a.currency),a.load(d))}),a.$watch("currency_filter",function(b){a.currency=b,b&&b!=d.transfer_unit&&(d.transfer_unit=b,a.year&&(d.transfer_year=a.year),a.load(d))}),a.$watch("pie",function(b){void 0!=a.api&&a.api.refresh()})}]),angular.module("app").controller("nrgiAllProjectListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiAllProjectsSrvc","$filter",function(a,b,c,d,e,f){var g=50,h=0,i=0;a.count=0,a.busy=!1;var j,k,l,m=", ";a.csv_projects=[];var n=["proj_id","proj_name","proj_country","companies"],o=["Project ID","Name","Country","Companies"];a.getHeaderProjects=function(){return o},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_projects[c]=[],angular.forEach(n,function(d){"proj_country"==d&&(void 0!=b[d]&&b[d].length>0?(k="",angular.forEach(b[d],function(e,f){j="",void 0!=e&&(j=e.name.toString(),j=j.charAt(0).toUpperCase()+j.substr(1)),f!=b[d].length-1&&""!=j?k=k+j+m:(k+=j,a.csv_projects[c].push(k))})):a.csv_projects[c].push("")),"companies"==d&&(void 0!=b[d]&&b[d].length>0?(k="",angular.forEach(b[d],function(e,f){l="",void 0!=e&&e&&e.company_name&&(l=e.company_name.toString(),l=l.charAt(0).toUpperCase()+l.substr(1)),f!=b[d].length-1&&""!=l?k=k+l+m:(k+=l,a.csv_projects[c].push(k))})):a.csv_projects[c].push("")),"companies"!=d&&"proj_country"!=d&&a.csv_projects[c].push(b[d])})})},e.query({skip:h*g,limit:g},function(b){a.count=b.count,a.projects=b.projects,i=Math.ceil(b.count/g),h+=1,a.createDownloadList(a.projects)}),a.loadMore=function(){a.busy||(a.busy=!0,h<i&&e.query({skip:h*g,limit:g,record_type:a.record_type},function(b){a.projects=_.union(a.projects,b.projects),h+=1,a.busy=!1,a.createDownloadList(a.projects)}))}}]),angular.module("app").controller("nrgiProjectDetailCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiProjectsSrvc","$sce","usSpinnerService","$routeParams","nrgiProjectDataSrvc",function(a,b,c,d,e,f,g,h,i){a.openClose=!0,g.spin("spinner-filing"),e.get({_id:h.id},function(b){b.error?a.error=b.error:(a.id=b.project._id,a.url="http://newaleph.openoil.net/clients/resourceprojects/?project_name="+b.project.proj_name,a.project=b.project)}),a.$watch("id",function(b){void 0!=b&&i.get({_id:a.id},function(b){a.data=b})}),a.trustSrc=function(a){return f.trustAsResourceUrl(a)},a.iframeLoadedCallBack=function(){g.stop("spinner-filing"),angular.element(document.getElementsByTagName("iframe")).addClass("iframedata")}}]),angular.module("app").controller("nrgiProjectListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiProjectsSrvc","$filter",function(a,b,c,d,e,f){var g=50,h=0,i=0;a.count=0,a.busy=!1;var j,k,l,m,n,o,p=", ";a.csv_projects=[];var q=["proj_id","proj_name","verified","proj_country","proj_commodity_type","proj_commodity","proj_status","company_count","transfer_count","production_count"],r=["Project ID","Name","Verified Project","Country","Type","Commodity","Status","Companies","Payments","Production"];a.getHeaderProjects=function(){return r},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_projects[c]=[],angular.forEach(q,function(d){if("verified"==d&&(void 0!=b[d]?(b[d]=b[d].charAt(0).toUpperCase()+b[d].substr(1),a.csv_projects[c].push(b[d])):a.csv_projects[c].push("")),"proj_country"==d&&(void 0!=b[d]&&b[d].length>0?(k="",angular.forEach(b[d],function(e,f){j="",void 0!=e&&(j=e.name.toString(),j=j.charAt(0).toUpperCase()+j.substr(1)),f!=b[d].length-1&&""!=j?k=k+j+p:(k+=j,a.csv_projects[c].push(k))})):a.csv_projects[c].push("")),"proj_commodity_type"==d&&(void 0!=b.proj_commodity&&b.proj_commodity.length>0?(k="",b.proj_commodity=_.map(_.groupBy(b.proj_commodity,function(a){if(a&&null!=a)return a.commodity_type}),function(a){return a[0]}),angular.forEach(b.proj_commodity,function(d,e){l="",void 0!=d&&(l=d.commodity_type.toString(),l=l.charAt(0).toUpperCase()+l.substr(1)),e!=b.proj_commodity.length-1&&""!=l?k=k+l+p:(k+=l,a.csv_projects[c].push(k))})):a.csv_projects[c].push("")),"proj_commodity"==d&&(void 0!=b[d]&&b[d].length>0?(k="",b[d]=_.map(_.groupBy(b[d],function(a){if(a&&null!=a)return a.commodity_name}),function(a){return a[0]}),angular.forEach(b[d],function(e,f){m="",void 0!=e&&(m=e.commodity_name.toString(),m=m.charAt(0).toUpperCase()+m.substr(1)),f!=b[d].length-1&&""!=m?k=k+m+p:(k+=m,a.csv_projects[c].push(k))})):a.csv_projects[c].push("")),"proj_status"==d)if(void 0!=b[d]&&b[d].length>0){k="";var e=b[d];o="",void 0!=e[b[d].length-1]?(o=e[b[d].length-1].string.toString(),o=o.charAt(0).toUpperCase()+o.substr(1),n=f("date")(o[b[d].length-1].timestamp,"MM/dd/yyyy @ h:mma"),k=o+"(true at "+n+")",a.csv_projects[c].push(k)):a.csv_projects[c].push(k)}else a.csv_projects[c].push("");"verified"!=d&&"proj_country"!=d&&"proj_commodity_type"!=d&&"proj_commodity"!=d&&"proj_status"!=d&&a.csv_projects[c].push(b[d])})})},e.query({skip:h*g,limit:g},function(b){a.count=b.count,a.projects=b.projects,i=Math.ceil(b.count/g),h+=1,a.createDownloadList(a.projects)}),a.loadMore=function(){a.busy||(a.busy=!0,h<i&&e.query({skip:h*g,limit:g,record_type:a.record_type},function(b){a.projects=_.union(a.projects,b.projects),h+=1,a.busy=!1,a.createDownloadList(a.projects)}))}}]),angular.module("app").controller("nrgiMapSiteCtrl",["$scope","nrgiSitesSrvc","$location",function(a,b,c){a.field=!1,"/sites/map"==c.path()?(a.field=!1,a.record_type="sites",a.header="Site"):(a.field=!0,a.record_type="fields",a.header="Field"),b.get({map:"map",field:a.field},function(b){a.siteMarkers=b.data})}]),angular.module("app").controller("nrgiSiteDetailCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiSitesSrvc","$routeParams",function(a,b,c,d,e,f){e.get({_id:f.id},function(b,c){b.site?(a.id=b.site._id,a.site=b.site):console.log(c)}),e.get({data:"data",_id:f.id},function(b,c){b?a.data=b:console.log(c)})}]),angular.module("app").controller("nrgiSiteListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiSitesSrvc","$location","$filter",function(a,b,c,d,e,f,g){var h=50,i=0,j=0;a.count=0,a.field=!1,a.busy=!1,"/sites"==f.path()?(a.field=!1,a.record_type="sites",a.route="site",a.header="Sites"):"/fields"==f.path()&&(a.field=!0,a.route="field",a.record_type="fields",a.header="Fields");var k,l,m,n,o,p,q=", ";a.csv_file=[];var r=["site_name","site_country","site_commodity_type","site_commodity","site_status","company_count","project_count","concession_count","transfer_count","production_count"],s=["Name","Country","Commodity Type","Commodity","Status","Companies","Projects","Concessions","Payments","Production"];a.getHeader=function(){return s},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_file[c]=[],angular.forEach(r,function(d){"site_country"==d&&(void 0!=b[d]&&b[d].length>0?(l="",angular.forEach(b[d],function(e,f){k="",void 0!=e&&e.name&&(k=e.name.toString(),k=k.charAt(0).toUpperCase()+k.substr(1)),f!=b[d].length-1&&""!=k?l=l+k+q:(l+=k,a.csv_file[c].push(l))})):a.csv_file[c].push("")),"site_commodity_type"==d&&(void 0!=b.site_commodity&&b.site_commodity.length>0?(l="",b.site_commodity=_.map(_.groupBy(b.site_commodity,function(a){if(a&&a.commodity_type)return a.commodity_type}),function(a){return a[0]}),angular.forEach(b.site_commodity,function(d,e){m="",void 0!=d&&d.commodity_type&&(m=d.commodity_type.toString(),m=m.charAt(0).toUpperCase()+m.substr(1)),e!=b.site_commodity.length-1&&""!=m?l=l+m+q:(l+=m,a.csv_file[c].push(l))})):a.csv_file[c].push("")),"site_commodity"==d&&(void 0!=b[d]&&b[d].length>0?(l="",b[d]=_.map(_.groupBy(b[d],function(a){if(a&&a.commodity_name)return a.commodity_name}),function(a){return a[0];
}),angular.forEach(b[d],function(e,f){n="",void 0!=e&&e.commodity_name&&(n=e.commodity_name.toString(),n=n.charAt(0).toUpperCase()+n.substr(1)),f!=b[d].length-1&&""!=n?l=l+n+q:(l+=n,a.csv_file[c].push(l))})):a.csv_file[c].push("")),"site_status"==d&&(void 0!=b[d]&&b[d].length>0?(l="",angular.forEach(b[d],function(b,d){p="",void 0!=b&&(p=b.string.toString(),p=p.charAt(0).toUpperCase()+p.substr(1),o=g("date")(b.timestamp,"MM/dd/yyyy @ h:mma"),l=p+"(true at "+o+")",a.csv_file[c].push(l))})):a.csv_file[c].push("")),"site_country"!=d&&"site_commodity_type"!=d&&"site_commodity"!=d&&"site_status"!=d&&a.csv_file[c].push(b[d])})})},e.query({skip:i*h,limit:h,field:a.field},function(b){a.count=b.count,a.sites=b.sites,j=Math.ceil(b.count/h),i+=1,a.createDownloadList(a.sites)}),a.loadMore=function(){a.busy||(a.busy=!0,i<j&&e.query({skip:i*h,limit:h,field:a.field},function(b){a.sites=_.union(a.sites,b.sites),i+=1,a.busy=!1,a.createDownloadList(a.sites)}))}}]),angular.module("app").controller("nrgiSourceDetailCtrl",["$scope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiSourcesSrvc","$routeParams",function(a,b,c,d,e){d.get({_id:e.id},function(b){a.source=b.source})}]),angular.module("app").controller("nrgiSourceListCtrl",["$scope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiSourcesSrvc","$filter",function(a,b,c,d,e){var f=50,g=0,h=0;a.count=0,a.field=!1,a.busy=!1,a.csv_sources=[];var i=["source_name","source_type_id","source_url","source_date","retrieve_date"],j=["Source","Source type","Access source","Source date","Retrieved date"];a.getHeaderSources=function(){return j},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_sources[c]=[],angular.forEach(i,function(d){"source_type_id"==d&&(b[d]&&b[d].source_type_name?a.csv_sources[c].push(b[d].source_type_name):a.csv_sources[c].push("")),"source_date"!=d&&"retrieve_date"!=d||(b[d]=e("date")(b[d],"yyyy-MM-dd"),a.csv_sources[c].push(b[d])),"source_date"!=d&&"retrieve_date"!=d&&"source_type_id"!=d&&a.csv_sources[c].push(b[d])})})},d.query({skip:g*f,limit:f},function(b){a.count=b.count,a.sources=b.sources,a.types=[],h=Math.ceil(b.count/f),g+=1,a.createDownloadList(a.sources),_.each(b.sources,function(b){a.types.push(b.source_type_id)}),a.source_type_id=_.countBy(a.types,"source_type_name")}),a.$watch("source_type_filter",function(b){g=0,h=0;var c={skip:g,limit:f};b&&(_.each(a.types,function(a){a&&a.source_type_name.toString()==b.toString()&&(c.source_type_id=a._id)}),d.query(c,function(b){b.reason?nrgiNotifier.error("Load document data failure"):(a.count=b.count,a.sources=b.sources,h=Math.ceil(b.count/f),g+=1,a.createDownloadList(a.sources))}))}),a.loadMore=function(){a.busy||(a.busy=!0,g<h&&d.query({skip:g*f,limit:f},function(b){a.sources=_.union(a.sources,b.sources),g+=1,a.busy=!1,a.createDownloadList(a.sources)}))}}]),angular.module("app").controller("nrgiSourceTypeDetailCtrl",["$scope","nrgiSourceTypesSrvc","$routeParams",function(a,b,c){b.get({_id:c.id},function(b){a.source_type=b.sourceTypes})}]),angular.module("app").controller("nrgiSourceTypeListCtrl",["$scope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiSourceTypesSrvc","$rootScope",function(a,b,c,d,e){var f=50,g=0,h=0;a.count=0,a.field=!1,a.busy=!1,a.csv_source_types=[];var i=["source_type_name","source_type_authority","project_count"],j=["Source","Type","Projects","Countries"];a.getHeaderSourceTypes=function(){return j},a.createDownloadList=function(b){angular.forEach(b,function(b,c){a.csv_source_types[c]=[],angular.forEach(i,function(d){a.csv_source_types[c].push(b[d])})})},d.query({skip:g*f,limit:f},function(b){a.count=b.count,a.sourceTypes=b.data,h=Math.ceil(b.count/f),g+=1,a.createDownloadList(a.sourceTypes)}),a.loadMore=function(){a.busy||(a.busy=!0,g<h&&d.query({skip:g*f,limit:f},function(b){a.sourceTypes=_.union(a.sourceTypes,b.data),g+=1,a.busy=!1,a.createDownloadList(a.sourceTypes)}))}}]),angular.module("app").controller("nrgiTransferListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiTransfersSrvc","nrgiTransferFilters","$filter",function(a,b,c,d,e,f,g){var h=0,i=0,j={},k=[],l=[],m="",n="",o="";a.limit=500,a.skip=h*a.limit,a.count=0,a.busy=!1,a["new"]=!0,a.transfers=[],a.currency="",a.year="",a.type_filter="Show all types",a.company_filter="Show all companies",a.country_filter="Show all countries",a.load=function(b){b.skip=a.skip,e.query(b,function(b){b.transfers?(a.count=b.count,a["new"]?a.transfers=b.transfers:a.transfers=_.union(a.transfers,b.transfers),a.transfer_count=b.transfers.length,i=Math.ceil(b.count/a.limit),h+=1,a.skip=h*a.limit,a.busy=!1):a.transfers=[]})},f.query({country:!1},function(b){b.filters&&Object.keys(b.filters).length>0?(a.year_selector=b.filters.year_selector,a.currency_selector=b.filters.currency_selector,a.type_selector=b.filters.type_selector,a.company_selector=b.filters.company_selector,a.country_selector=b.filters.country_selector,_.indexOf(a.currency_selector,"USD")?a.currency_filter="USD":a.currency_selector&&a.currency_selector[0]&&(a.currency_filter=a.currency_selector[0]),_.indexOf(a.year_selector,"2015")?a.year_filter="2015":a.year_selector&&a.year_selector[0]&&(a.year_filter=a.year_selector[0]),j={skip:a.skip,limit:a.limit,transfer_year:a.year_filter,transfer_unit:a.currency_filter}):(a.currency_filter="Show all currency",a.year_filter="Show all years",j={skip:a.skip,limit:a.limit}),a.load(j)}),a.$watch("year_filter",function(b){a.year=b,a["new"]=!0,j.transfer_year!=b&&b&&"Show all years"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.transfer_year=b,a.load(j)):j.transfer_year&&"Show all years"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.transfer_year,a.load(j))}),a.$watch("currency_filter",function(b){a.currency=b,a["new"]=!0,j.transfer_unit!=b&&b&&"Show all currency"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.transfer_unit=b,a.load(j)):j.transfer_unit&&"Show all currency"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.transfer_unit,a.load(j))}),a.$watch("type_filter",function(b){a.type=b,b&&"Show all types"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.transfer_type=b,a.load(j)):j.transfer_type&&"Show all types"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.transfer_type,a.load(j))}),a.$watch("company_filter",function(b){a.company=b,b&&"Show all companies"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.company=b,a.load(j)):j.company&&"Show all companies"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.company,a.load(j))}),a.$watch("country_filter",function(b){a.country=b,b&&"Show all countries"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.country=b,a.load(j)):j.country&&"Show all countries"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.country,a.load(j))}),a.loadMore=function(){a.busy||(a.busy=!0,h<i&&(a["new"]=!1,a.load(j)))};var p=[{name:"Year",status:!0,field:"transfer_year"},{name:"Company",status:!0,field:"company"},{name:"Country",status:!0,field:"country"},{name:"Project",status:!0,field:"proj_site"},{name:"Project ID",status:!0,field:"proj_id"},{name:"Level ",status:!0,field:"transfer_gov_entity"},{name:"Payment Type",status:!0,field:"transfer_type"},{name:"Currency",status:!0,field:"transfer_unit"},{name:"Value ",status:!0,field:"transfer_value"}];angular.forEach(p,function(a){0!=a.status&&void 0!=a.status&&(k.push(a.name),l.push(a.field))}),a.getHeaderTransfers=function(){return k},a.load_all=function(){a.busy||(a.busy=!0,e.query({skip:0,limit:a.count},function(b){a.csv_transfers=[],angular.forEach(b.transfers,function(b,c){a.csv_transfers[c]=[],angular.forEach(l,function(d){if("transfer_value"==d&&(o="",o=g("currency")(b[d],"",0),a.csv_transfers[c].push(o)),"country"==d&&(m="",void 0!=b[d]&&b[d].name&&(m=b[d].name.toString(),m=m.charAt(0).toUpperCase()+m.substr(1)),a.csv_transfers[c].push(m)),"company"==d&&(n="",void 0!=b[d]&&b[d].company_name&&(n=b[d].company_name.toString(),n=n.charAt(0).toUpperCase()+n.substr(1)),a.csv_transfers[c].push(n)),"transfer_gov_entity"==d&&(b[d]&&(e=b[d]),b[d]||(e=void 0!=b.proj_site?b.proj_site.type:""),a.csv_transfers[c].push(e)),"proj_site"==d){if(e="",void 0!=b[d]&&void 0!=b[d].name)var e=b[d].name.toString();a.csv_transfers[c].push(e)}if("proj_id"==d){if(f="",void 0!=b.proj_site&&void 0!=b.proj_site._id&&"project"==b.proj_site.type)var f=b.proj_site._id.toString();a.csv_transfers[c].push(f)}"company"!=d&&"transfer_gov_entity"!=d&&"country"!=d&&"proj_site"!=d&&"proj_id"!=d&&"transfer_value"!=d&&a.csv_transfers[c].push(b[d])})})}))}}]),angular.module("app").controller("nrgiTransferByGovListCtrl",["$scope","$rootScope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiTransfersByGovSrvc","nrgiTransferFilters","$filter",function(a,b,c,d,e,f,g){var h=0,i=0,j={},k=[],l=[],m="",n="",o="";a.limit=500,a.skip=h*a.limit,a["new"]=!0,a.count=0,a.busy=!1,a.transfers=[],a.currency="",a.year="",a.type_filter="Show all types",a.company_filter="Show all companies",a.country_filter="Show all countries",a.load=function(b){b.skip=a.skip,e.query(b,function(b){b.transfers?(a.count=b.count,a["new"]?a.transfers=b.transfers:a.transfers=_.union(a.transfers,b.transfers),a.transfer_count=b.transfers.length,i=Math.ceil(b.count/a.limit),h+=1,a.skip=h*a.limit,a.busy=!1):a.transfers=[]})},f.query({country:!0},function(b){Object.keys(b.filters).length>0?(a.year_selector=b.filters.year_selector,a.currency_selector=b.filters.currency_selector,a.type_selector=b.filters.type_selector,a.company_selector=b.filters.company_selector,a.country_selector=b.filters.country_selector,_.indexOf(a.currency_selector,"USD")?a.currency_filter="USD":a.currency_selector&&a.currency_selector[0]&&(a.currency_filter=a.currency_selector[0]),_.indexOf(a.year_selector,"2015")?a.year_filter="2015":a.year_selector&&a.year_selector[0]&&(a.year_filter=a.year_selector[0]),j={skip:a.skip,limit:a.limit,transfer_year:a.year_filter,transfer_unit:a.currency_filter}):(j={skip:a.skip,limit:a.limit},a.currency_filter="Show all currency",a.year_filter="Show all years"),a.load(j)}),a.$watch("year_filter",function(b){a.year=b,a["new"]=!0,j.transfer_year!=b&&b&&"Show all years"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.transfer_year=b,a.load(j)):j.transfer_year&&"Show all years"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.transfer_year,a.load(j))}),a.$watch("currency_filter",function(b){a.currency=b,a["new"]=!0,j.transfer_unit!=b&&b&&"Show all currency"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.transfer_unit=b,a.load(j)):j.transfer_unit&&"Show all currency"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.transfer_unit,a.load(j))}),a.$watch("type_filter",function(b){a.type=b,b&&"Show all types"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.transfer_type=b,a.load(j)):j.transfer_type&&"Show all types"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.transfer_type,a.load(j))}),a.$watch("company_filter",function(b){a.company=b,b&&"Show all companies"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.company=b,a.load(j)):j.company&&"Show all companies"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.company,a.load(j))}),a.$watch("country_filter",function(b){a.country=b,b&&"Show all countries"!=b?(a.skip=0,j.skip=0,j.limit=500,h=0,j.country=b,a.load(j)):j.country&&"Show all countries"==b&&(a.skip=0,j.skip=0,j.limit=500,h=0,delete j.country,a.load(j))}),a.loadMore=function(){a.busy||(a.busy=!0,h<i&&(a["new"]=!1,a.load(j)))};var p=[{name:"Year",status:!0,field:"transfer_year"},{name:"Company",status:!0,field:"company"},{name:"Country",status:!0,field:"country"},{name:"Government entity",status:!0,field:"transfer_gov_entity"},{name:"Level ",status:!0,field:"transfer_level"},{name:"Payment Type",status:!0,field:"transfer_type"},{name:"Currency",status:!0,field:"transfer_unit"},{name:"Value ",status:!0,field:"transfer_value"}];angular.forEach(p,function(a){0!=a.status&&void 0!=a.status&&(k.push(a.name),l.push(a.field))}),a.getHeaderTransfers=function(){return k},a.load_all=function(){a.busy||(a.busy=!0,e.query({skip:0,limit:a.count},function(b){a.csv_transfers=[],angular.forEach(b.transfers,function(b,c){a.csv_transfers[c]=[],angular.forEach(l,function(d){"transfer_value"==d&&(n="",n=g("currency")(b[d],"",0),a.csv_transfers[c].push(n)),"country"==d&&(m="",void 0!=b[d]&&b[d].name&&(m=b[d].name.toString(),m=m.charAt(0).toUpperCase()+m.substr(1)),a.csv_transfers[c].push(m)),"company"==d&&(o="",void 0!=b[d]&&b[d].company_name&&(o=b[d].company_name.toString(),o=o.charAt(0).toUpperCase()+o.substr(1)),a.csv_transfers[c].push(o)),"company"!=d&&"country"!=d&&"transfer_value"!=d&&a.csv_transfers[c].push(b[d])})})}))}}]),angular.module("app").controller("nrgiMainCtrl",["$scope","nrgiAuthSrvc","nrgiIdentitySrvc","nrgiLandingPageContentSrvc",function(a,b,c,d){a.current_user=c.currentUser,d.get(function(b){a.content=b},function(a){})}]),angular.module("app").controller("nrgiNavBarCtrl",["$scope","$http","$location","nrgiNotifier","nrgiIdentitySrvc","nrgiAuthSrvc",function(a,b,c,d,e,f){a.identity=e,a.signout=function(){f.logoutUser().then(function(){a.username="",a.password="",d.notify("You have successfully signed out!"),c.path("/")})}}]),angular.module("app").factory("nrgiCommoditiesMethodSrvc",["$q","nrgiCommoditiesSrvc",function(a,b){return{createCommodity:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateCommodity:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteCommodity:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiCompaniesMethodSrvc",["$q","nrgiCompaniesSrvc",function(a,b){return{createCompany:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateCompany:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteCompany:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiConcessionsMethodSrvc",["$q","nrgiConcessionsSrvc",function(a,b){return{createConcession:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateConcession:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteConcession:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiContentMethodSrvc",["$q",function(a){return{updateContentPage:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise}}}]),angular.module("app").factory("nrgiContractsMethodSrvc",["$q","nrgiContractsSrvc",function(a,b){return{createContract:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},deleteContract:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise},updateContract:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise}}}]),angular.module("app").factory("nrgiCountriesMethodSrvc",["$q","nrgiCountriesSrvc",function(a,b){return{createCountry:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateCountry:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteCountry:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiDatasetActionMethodSrvc",["$http","$q","nrgiDatasetActionSrvc",function(a,b,c){return{createAction:function(a){var d=new c(a),e=b.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise}}}]),angular.module("app").factory("nrgiDatasetMethodSrvc",["$http","$q","nrgiDatasetSrvc",function(a,b,c){return{createDataset:function(a){var d=new c(a),e=b.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateDataset:function(a){var c=b.defer();return a.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},createAction:function(a){var c=new nrgiActionSrvc(a),d=b.defer();return c.$save().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise},deleteDataset:function(a){var d=b.defer(),e=new c;return e.id=a,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiGroupsMethodSrvc",["$q","nrgiGroupsSrvc",function(a,b){return{createGroup:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateGroup:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteGroup:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiMethodSrvc",["$q","nrgiCommoditiesSrvc",function(a,b){return{create:function(b,c){var d=new srvc(b),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},update:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteCommodity:function(b){var c=a.defer(),d=new srvc;return d.id=b,d.$delete().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise}}}]),angular.module("app").factory("nrgiProjectsMethodSrvc",["$q","nrgiProjectsSrvc",function(a,b){return{createProject:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateProject:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteProject:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiSitesMethodSrvc",["$q","nrgiSitesSrvc",function(a,b){return{createSite:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateSite:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteSite:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiSourcesMethodSrvc",["$q","nrgiSourcesSrvc",function(a,b){return{createSource:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateSource:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteSource:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiSourceTypesMethodSrvc",["$q","nrgiSourceTypesSrvc",function(a,b){return{createSourceType:function(c){var d=new b(c),e=a.defer();return d.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateSourceType:function(b){var c=a.defer();return b.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteSourceType:function(c){var d=a.defer(),e=new b;return e.id=c,e.$delete().then(function(){d.resolve()},function(a){d.reject(a.data.reason)}),d.promise}}}]),angular.module("app").factory("nrgiUserMethodSrvc",["$http","$q","nrgiIdentitySrvc","nrgiUserSrvc",function(a,b,c,d){return{createUser:function(a){var c=new d(a),e=b.defer();return c.$save().then(function(){e.resolve()},function(a){e.reject(a.data.reason)}),e.promise},updateUser:function(a){var c=b.defer();return a.$update().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise},deleteUser:function(a){var c=b.defer(),e=new d;return e.id=a,e.$delete().then(function(){c.resolve()},function(a){c.reject(a.data.reason)}),c.promise}}}]),angular.module("app").factory("nrgiAuthSrvc",["$http","$q","nrgiIdentitySrvc","nrgiUserSrvc",function(a,b,c,d){return{authenticateUser:function(e,f){var g=b.defer();return a.post("/login",{username:e,password:f}).then(function(a){if(a.data.success){var b=new d;angular.extend(b,a.data.user),c.currentUser=b,g.resolve(!0)}else g.resolve(!1)}),g.promise},logoutUser:function(){var d=b.defer();return a.post("/logout",{logout:!0}).then(function(){c.currentUser=void 0,d.resolve()}),d.promise},authorizeCurrentUserForRoute:function(a){return!!c.isAuthorized(a)||b.reject("not authorized")},authorizeAuthenticatedUserForRoute:function(){return!!c.isAuthenticated()||b.reject("not authorized")}}}]),angular.module("app").factory("nrgiCommoditiesSrvc",["$resource",function(a){var b=a("/api/commodities/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]),angular.module("app").factory("nrgiCompaniesSrvc",["$resource",function(a){var b=a("/api/companies/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiCompanyDataSrvc",["$resource",function(a){var b=a("/api/companydata/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiConcessionsSrvc",["$resource",function(a){var b=a("/api/concessions/:limit/:skip/:data/:_id",{_id:"@id",limit:"@limit",skip:"@skip",data:"@data"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiConcessionDataSrvc",["$resource",function(a){var b=a("/api/concession/data/:_id",{_id:"@id",data:"@data"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]),angular.module("app").factory("nrgiAboutPageContentSrvc",["$resource",function(a){var b=a("/api/about",{},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiGlossaryPageContentSrvc",["$resource",function(a){var b=a("/api/glossary",{},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiLandingPageContentSrvc",["$resource",function(a){var b=a("/api/landing",{},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]),angular.module("app").factory("nrgiContractsSrvc",["$resource",function(a){var b=a("/api/contracts/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]),angular.module("app").factory("nrgiCountriesSrvc",["$resource",function(a){var b=a("/api/countries/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiCountryCommoditiesSrvc",["$resource",function(a){var b=a("/api/countrycommodity/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiDatasetActionSrvc",["$resource",function(a){var b=a("/api/datasets/:_id/actions",{_id:"@id"},{save:{method:"POST",isArray:!1}});return b}]),angular.module("app").factory("nrgiDatasetSrvc",["$resource",function(a){var b=a("/api/datasets/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1},save:{method:"POST",isArray:!1}});return b}]),angular.module("app").factory("nrgiDestroySrvc",["$resource",function(a){var b=a("/api/destroy",{},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiDuplicatesSrvc",["$resource",function(a){var b=a("/api/duplicates/:type/:limit/:skip/:id/:action",{id:"@id",action:"@action",limit:"@limit",skip:"@skip",type:"@type"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiResolveSrvc",["$resource",function(a){var b=a("/api/resolve/:type",{type:"@type"},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiGroupsSrvc",["$resource",function(a){var b=a("/api/companyGroups/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiGroupDataSrvc",["$resource",function(a){var b=a("/api/companyGroupData/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiIdentitySrvc",["$window","nrgiUserSrvc",function(a,b){var c;return a.bootstrappedUserObject&&(c=new b,angular.extend(c,a.bootstrappedUserObject)),{currentUser:c,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(a){return!!this.currentUser&&this.currentUser.role.indexOf(a)>-1}}}]),angular.module("app").factory("nrgiLastAddedSrvc",["$resource",function(a){var b=a("/api/last_added",{},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiCountryCoordinatesSrvc",["$resource",function(a){var b=a("/api/coordinate/:type/:_id",{_id:"@id",type:"@type"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiMainMapSrvc",["$resource",function(a){var b=a("/api/main_map/",{},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiTreeMapSrvc",["$resource",function(a){var b=a("/api/treemap/",{},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiProjectsSrvc",["$resource",function(a){var b=a("/api/projects/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiAllProjectsSrvc",["$resource",function(a){var b=a("/api/all_projects/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiProjectDataSrvc",["$resource",function(a){var b=a("/api/project/data/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiCommoditiesSrvc",["$resource",function(a){var b=a("/api/commodities/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiCompaniesSrvc",["$resource",function(a){var b=a("/api/companies/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiCompanyDataSrvc",["$resource",function(a){var b=a("/api/companydata/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiConcessionsSrvc",["$resource",function(a){var b=a("/api/concessions/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiContractsSrvc",["$resource",function(a){var b=a("/api/contracts/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiCountriesSrvc",["$resource",function(a){var b=a("/api/countries/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiCountryCommoditiesSrvc",["$resource",function(a){var b=a("/api/countrycommodity/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiCountryCoordinatesSrvc",["$resource",function(a){var b=a("/api/coordinate/:type/:_id",{_id:"@id",type:"@type"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiDatasetSrvc",["$resource",function(a){var b=a("/api/datasets/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1},save:{method:"POST",isArray:!1}});return b}]).factory("nrgiDatasetActionSrvc",["$resource",function(a){var b=a("/api/datasets/:_id/actions",{_id:"@id"},{save:{method:"POST",isArray:!1}});return b}]).factory("nrgiGroupsSrvc",["$resource",function(a){var b=a("/api/companyGroups/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiGroupDataSrvc",["$resource",function(a){var b=a("/api/companyGroupData/:_id",{_id:"@id"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiProjectsSrvc",["$resource",function(a){var b=a("/api/projects/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiSitesSrvc",["$resource",function(a){var b=a("/api/sites/:limit/:skip/:map/:field/:_id",{_id:"@id",limit:"@limit",skip:"@skip",field:"@field",map:"@map"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiSourcesSrvc",["$resource",function(a){var b=a("/api/sources/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiSourceTypesSrvc",["$resource",function(a){var b=a("/api/sourcetypes/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiTransfersSrvc",["$resource",function(a){var b=a("/api/transfers/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]),angular.module("app").factory("nrgiSitesSrvc",["$resource",function(a){var b=a("/api/sites/:limit/:skip/:map/:data/:field/:_id",{_id:"@id",limit:"@limit",skip:"@skip",field:"@field",map:"@map",data:"@data"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]),angular.module("app").factory("nrgiSourcesSrvc",["$resource",function(a){var b=a("/api/sources/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]),angular.module("app").factory("nrgiSourceTypesSrvc",["$resource",function(a){var b=a("/api/sourcetypes/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]),angular.module("app").factory("nrgiPaymentsSrvc",["$resource",function(a){var b=a("/api/transfers",{},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiPieChartSrvc",["$resource",function(a){var b=a("/api/pie_chart",{},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiPaymentsByGovSrvc",["$resource",function(a){var b=a("/api/transfers_by_gov",{},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiTablesSrvc",["$resource",function(a){var b=a("/api/company_table/:type/:_id/:limit/:skip",{_id:"@id",type:"@type",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiProjectTablesSrvc",["$resource",function(a){var b=a("/api/project_table/:type/:_id/:limit/:skip",{_id:"@id",type:"@type",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiProdTablesSrvc",["$resource",function(a){var b=a("/api/prod_table/:type/:_id/:limit/:skip",{_id:"@id",type:"@type",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiTransferTablesSrvc",["$resource",function(a){var b=a("/api/transfer_table/:type/:_id/:limit/:skip",{_id:"@id",type:"@type",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiSourceTablesSrvc",["$resource",function(a){
var b=a("/api/source_table/:type/:_id",{_id:"@id",type:"@type"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiSiteFieldTablesSrvc",["$resource",function(a){var b=a("/api/site_table/:type/:_id/:limit/:skip",{_id:"@id",type:"@type",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiContractTablesSrvc",["$resource",function(a){var b=a("/api/contract_table/:type/:_id",{_id:"@id",type:"@type"},{query:{method:"GET",isArray:!1}});return b}]).factory("nrgiConcessionTablesSrvc",["$resource",function(a){var b=a("/api/concession_table/:type/:_id/:limit/:skip",{_id:"@id",type:"@type",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiTransfersSrvc",["$resource",function(a){var b=a("/api/transfers/:limit/:skip/:_id",{_id:"@id",limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiTransfersByGovSrvc",["$resource",function(a){var b=a("/api/transfersGov/:limit/:skip",{limit:"@limit",skip:"@skip"},{query:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return b}]).factory("nrgiTransferFilters",["$resource",function(a){var b=a("/api/transfer_filters/:country",{country:"@country"},{query:{method:"GET",isArray:!1}});return b}]),angular.module("app").factory("nrgiUserListSrvc",["$resource",function(a){var b=a("/api/user-list/:_id",{_id:"@id"},{});return b}]),angular.module("app").factory("nrgiUserSrvc",["$resource",function(a){var b=a("/api/users/:_id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return b.prototype.isSupervisor=function(){return this.roles&&this.roles.indexOf("supervisor")>-1},b.prototype.isReviewer=function(){return this.roles&&this.roles.indexOf("reviewer")>-1},b.prototype.isResearcher=function(){return this.roles&&this.roles.indexOf("researcher")>-1},b}]),angular.module("app").controller("nrgiAboutCtrl",["$scope","nrgiAboutPageContentSrvc",function(a,b){b.get(function(b){a.content=b},function(a){})}]),angular.module("app").controller("nrgiGlossaryCtrl",["$scope","nrgiGlossaryPageContentSrvc",function(a,b){b.get(function(b){a.content=b},function(a){})}]);