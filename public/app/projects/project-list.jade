.container
    .page-header
        .row
            .col-md-4
                h1 Projects
                    = ' '
                    small(ng-if="count") {{count | number}} loaded
            .col-md-5
            .col-md-3
                .btn-group(role='group', aria-label='...')
                    button.btn.btn-default.pull-right(type='button')
                        a(href='/projects/map') Map View

    nrgi-list-nav(
    page="page"
    type="record_type"
    show="show_count"
    count="count"
    limit="limit"
    last="last"
    next="next"
    prev="prev"
    first="first"
    select="select")

    table#projects.table.table-striped(about='http://resourceprojects.org/project',ts-wrapper)
        thead
            tr
                th.col-md-2.tablesort-sortable-th(ts-criteria='proj_name') Name
                th.col-md-1.tablesort-sortable-th(ts-criteria='proj_name') Verified Project
                th.col-md-1.tablesort-sortable-th(ts-criteria='proj_country[proj_country.length - 1].country.name') Country
                th.col-md-1.tablesort-sortable-th(ts-criteria='proj_commodity[proj_commodity.length - 1].commodity.commodity_type') Type
                th.col-md-1.tablesort-sortable-th(ts-criteria='proj_commodity[proj_commodity.length-1].commodity.commodity_name') Commodity
                th.col-md-2.tablesort-sortable-th(ts-criteria='proj_status[proj_status.length-1].string') Status
                th.col-md-1.text-center.tablesort-sortable-th(ts-criteria="company_count | parseInt")  Companies
                th.col-md-1.text-center.tablesort-sortable-th(ts-criteria="transfer_count | parseInt")  Payments
                th.col-md-1.text-center.tablesort-sortable-th(ts-criteria="production_count | parseInt")  Production
                //th.col-md-1.text-center.tablesort-sortable-th(ts-criteria="site_transfers|parseInt")  Associated Payments
        tbody
            tr(ng-repeat="project in projects | unique: '_id'",ts-repeat)
                td.col-md-2.proj_name
                    a(href='project/{{project.proj_id}}')
                        span(ng-bind-html="project.proj_name|sanitize")
                td.col-md-1.proj_verified
                    text.text-danger(ng-if="!project.source_type.c && !project.source_type.p") None
                    text.text-warning(ng-if="project.source_type.c && !project.source_type.p") Context
                    text.text-warning(ng-if="!project.source_type.c && project.source_type.p") Payment
                    text.text-success(ng-if="project.source_type.c && project.source_type.p") Verified
                td.col-md-1.proj_country: text(ng-repeat="country in project.proj_country | unique: 'country._id'")
                    a(href='/country/{{country.country.iso2}}')
                        span(ng-bind-html="country.country.name|sanitize")
                    | {{$last ? '' : ', '}}
                td.col-md-1.proj_commodity_type
                    text(ng-repeat="commodity in project.proj_commodity | unique: 'commodity.commodity_type'")
                        | {{commodity.commodity.commodity_type | ucfirst | addSpaces}}
                        | {{$last ? '' : ', '}}
                td.col-md-1.proj_commodity: text(ng-repeat="commodity in project.proj_commodity | unique: 'commodity._id'")
                    a(href='commodity/{{commodity.commodity.commodity_id}}')
                        span(ng-bind-html="commodity.commodity.commodity_name|sanitize")
                    | {{$last ? '' : ', '}}
                td.col-md-2.proj_status
                    em(ng-if="project.proj_status.length<1") ..
                    text(ng-if="project.proj_status.length>0" ng-repeat="status in project.proj_status")
                        text(ng-if="$last")
                            | {{status.string | ucfirst}}
                            text.small(ng-if="status.timestamp")  (true at {{status.timestamp | date:'MM/dd/yyyy @ h:mma' : timezone}})
                td.col-md-1.text-center.proj_company_count {{project.company_count}}
                td.col-md-1.text-center.proj_transfer_count {{project.transfer_count}}
                td.col-md-1.text-center.proj_transfer_count {{project.production_count}}
                //td.col-md-1.text-center.proj_associated_transfer_count {{project.site_transfers}}
    nrgi-list-nav(
    page="page"
    type="record_type"
    show="show_count"
    count="count"
    limit="limit"
    last="last"
    next="next"
    prev="prev"
    first="first"
    select="select")
    //div(infinite-scroll="loadProjects()" infinite-scroll-distance="3")