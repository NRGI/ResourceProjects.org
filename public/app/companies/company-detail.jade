.container
    .page-header
        h1
            span(ng-bind-html="company.company_name|sanitize")
            =' '
            small Company
    .row
        .col-md-12
            leaflet(
            center="company.countryMap"
            controls="controls"
            markers="company.projectMarkers"
            tiles="tiles"
            height='300px')
    .row
        .col-md-6
            .info-box
                h2 Company Info
                table#company-info
                    tbody
                        tr
                            td.detail_label.small ID:
                            td.company_id {{company._id}}
                        tr
                            td.detail_label.small Website:
                            td.company_website
                                a(target="_blank" href='{{company.company_website.string }}') {{company.company_website.string}}
                        tr
                            td.detail_label.small Aliases:
                            td.company_aliases
                                text(ng-repeat="alias in company.company_aliases")
                                    | {{alias.alias}}
                                    | {{$last ? '' : ', '}}
                        tr
                            td.detail_label.small Part of:
                            td.company_part-of
                                text(ng-repeat="group in company.company_groups")
                                    a(href='group/{{group._id}}')
                                        span(ng-bind-html="group.company_group_name|sanitize")
                                    | {{$last ? '' : ', '}}

                        tr
                            td.detail_label.small Commodities:
                            td.company_commodities
                                text(ng-repeat="(id, commodity) in company.commodities")
                                    a(href='commoddity/{{id}}')
                                        span(ng-bind-html="commodity|sanitize")
                                    | {{$last ? '' : ', '}}
                        tr(ng-if='company.open_corporates_id')
                            td.detail_label.small Open Corporates ID:
                            td.company_open_corporates_id
                                a(target="_blank" href='https://opencorporates.com/companies/{{company.open_corporates_id}}') {{company.open_corporates_id}}
                        tr(ng-if='company.companies_house_id')
                            td.detail_label.small Companies House ID:
                            td.company_companies_house_id
                                a(target="_blank" href='https://beta.companieshouse.gov.uk/company/{{company.companies_house_id}}') {{company.companies_house_id}}
        .col-md-6
            .info-box
                h2
                    | &nbsp;
                table#company-description
                    tbody
                        tr
                            td.detail_label.small Desctiption:
                            td.company_description
                                span(ng-bind-html="company.description|sanitize")

    .row
        .col-md-12
            nrgi-project-table(projects="company.projects")

    .row.top-padding-med
        .col-md-6
            h2 Contracts
                a=' '
            table.table.table-striped.contracts(ts-wrapper)#contract-info
                thead
                    tr
                        th.tablesort-sortable-th(ts-criteria='name') Name
                        th.tablesort-sortable-th(ts-criteria='group') Country
                        th.tablesort-sortable-th(ts-criteria='group') Commodity
                        th.tablesort-sortable-th(ts-criteria='group') RC-ID
                tbody
                    tr(
                    ng-repeat="contract in company.contracts"
                    ts-repeat)
                        td.contract_name: a(href="contract/{{contract.idCompany}}"): span(ng-bind-html="contract.name|sanitize")
                        td.contract_country: a(href="country/{{contract.country._id}}"): span(ng-bind-html="contract.country|sanitize")
                        td.contract_commodity: a(href="commodity/{{contract.commodity._id}}"): span(ng-bind-html="contract.group|sanitize")
                        td.contract_rc_id: a(href="http://www.resourcecontracts.org/contract/{{contract}}"): span(ng-bind-html="contract|sanitize")
            .download
                span.glyphicon.glyphicon-download(aria-hidden="true")
                span
                    |  Download:
                    =' '
                    a(href="") Contracts CSV
                //a(href="/sparql?default-graph-uri=&amp;query=PREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0Aprefix+rp%3A+%3Chttp%3A%2F%2Fresourceprojects.org%2Fdef%2F%3E%0A%0ASELECT+DISTINCT+%3Fcompany+%3FcompanyName+%28xsd%3Astring%28%3Fgroup_%29+as+%3Fgroup%29++%3FgroupName+WHERE+%7B%0A++++%3Fproject+rp%3AhasLocation+%3Chttp%3A%2F%2Fresourceprojects.org%2Fcountry%2FAO%3E+.%0A++++%3Fproject+a+rp%3AProject+.%0A++++%3Fproject+skos%3AprefLabel+%3Fproject_name%0A++++%0A++++OPTIONAL+%7B+%3Fproject+rp%3AhasStake+%3Fstake+.%0A+++++++++++++++%3Fstake+rp%3AhasStakeholder+%3Fcompany+.%0A+++++++++++++++%3Fcompany+a+rp%3ACompany+.%0A+++++++++++++++%3Fcompany+skos%3AprefLabel+%3FcompanyName%0A++++++++OPTIONAL+%7B+%3FgroupMembership+rp%3Aorganisation+%3Fcompany+.%0A+++++++++++++++++++%3Fgroup_+rp%3AgroupMember+%3FgroupMembership+.%0A+++++++++++++++++++%3Fgroup_+skos%3AprefLabel+%3FgroupName%0A++++++++%7D%0A++++%7D+%0A%7D+%0AGROUP+BY+%3Fcompany+%3FcompanyName%0AORDER+BY+%3FcompanyName%0A&amp;format=text%2Fcsv&amp;timeout=0&amp;debug=on") Contracts CSV

        .col-md-6
            h2 Concessions
            table.table.table-striped.concessions(ts-wrapper)
                thead
                    tr
                        th.tablesort-sortable-th(ts-criteria='name')
                            | &nbsp; Name
                        th.tablesort-sortable-th(ts-criteria='commodity')
                            | &nbsp; Country
                        th.tablesort-sortable-th(ts-criteria='status')
                            | &nbsp; Commodity Type
                        th.tablesort-sortable-th(ts-criteria='count|parseInt')
                            | &nbsp; Commodity
                        th.tablesort-sortable-th(ts-criteria='count|parseInt')
                            | &nbsp; Status
                tbody
                    tr(ng-repeat='(key, concession) in company.concessions')
                        td.concession_name: a(href='/concessions/{{key}}')
                                span(ng-bind-html="concession.concession_name|sanitize")
                        td.concession_country: a(href='/country/{{concession.concession_country._id}}')
                            span(ng-bind-html="concession.concession_country.name|sanitize")
                        td.concession_type {{concession.concession_type.string | ucfirst}}
                        td.concession_commodity: text(ng-repeat="commodity in concession.concession_commodities | unique: 'commodity.commodity_code'")
                            a(href='commodity/{{commodity.commodity.commodity_code}}')
                                span(ng-bind-html="commodity.commodity.commodity_name|sanitize")
                            | {{$last ? '' : ', '}}
                        td.concession_status: text(
                        ng-repeat="status in concession.concession_status"
                        ng-if="concession.concession_status.length > 0")
                            text(ng-if="$last")
                                | {{status.string | ucfirst}}
                                text.small  (true at {{status.timestamp | date:'MM/dd/yyyy @ h:mma' : timezone}})
            .download
                span.glyphicon.glyphicon-download(aria-hidden="true")
                span
                    |  Download:
                    =' '
                    a(href="") Concessions CSV
                    //a(href="/sparql?default-graph-uri=&amp;query=PREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0Aprefix+rp%3A+%3Chttp%3A%2F%2Fresourceprojects.org%2Fdef%2F%3E%0A%0ASELECT+DISTINCT+%3Fproject+%3Fname+%28COUNT%28distinct+%3Fcompany%29+as+%3FcompanyCount%29+WHERE+%7B%0A++++%3Fproject+rp%3AhasLocation+%3Chttp%3A%2F%2Fresourceprojects.org%2Fcountry%2FAO%3E+.%0A++++%3Fproject+a+rp%3AProject+.%0A++++%3Fproject+skos%3AprefLabel+%3Fname%0A++++OPTIONAL+%7B%0A+++++++++++++++%3Fproject+rp%3AhasStake+%3Fstake+.%0A+++++++++++++++%3Fstake+rp%3AhasStakeholder+%3Fcompany+.%0A+++++++++++++++%3Fcompany+a+rp%3ACompany+%0A++++%7D%0A%7D+%0AORDER+BY+%28%3Fname%29%0A%0A%0A&amp;format=text%2Fcsv&amp;timeout=0&amp;debug=on") Concessions CSV

    .row
        .col-md-12
            nrgi-transfer-table(transfers="company.transfers")